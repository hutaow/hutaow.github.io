<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>胡桃夹子</title><link href="http://hutaow.com/" rel="alternate"></link><link href="http://hutaow.com/feeds/protocol.atom.xml" rel="self"></link><id>http://hutaow.com/</id><updated>2013-11-06T00:34:54+08:00</updated><entry><title>MySQL协议分析</title><link href="http://hutaow.com/blog/2013/11/06/mysql-protocol-analysis" rel="alternate"></link><updated>2013-11-06T00:34:54+08:00</updated><author><name>hutaow</name></author><id>tag:hutaow.com,2013-11-06:blog/2013/11/06/mysql-protocol-analysis</id><summary type="html">&lt;hr /&gt;
&lt;h2&gt;1 交互过程&lt;/h2&gt;
&lt;p&gt;MySQL客户端与服务器的交互主要分为两个阶段：握手认证阶段和命令执行阶段。&lt;/p&gt;
&lt;h3&gt;1.1 握手认证阶段&lt;/h3&gt;
&lt;p&gt;握手认证阶段为客户端与服务器建立连接后进行，交互过程如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;服务器 -&amp;gt; 客户端：握手初始化消息&lt;/li&gt;
&lt;li&gt;客户端 -&amp;gt; 服务器：登陆认证消息&lt;/li&gt;
&lt;li&gt;服务器 -&amp;gt; 客户端：认证结果消息&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;1.2 命令执行阶段&lt;/h3&gt;
&lt;p&gt;客户端认证成功后，会进入命令执行阶段，交互过程如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;客户端 -&amp;gt; 服务器：执行命令消息&lt;/li&gt;
&lt;li&gt;服务器 -&amp;gt; 客户端：命令执行结果&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- more --&gt;

&lt;p&gt;&lt;strong&gt;MySQL客户端与服务器的完整交互过程如下&lt;/strong&gt;：&lt;/p&gt;
&lt;p&gt;&lt;img alt="MySQL客户端与服务器交互示意图" src="/images/articles/201311/mysql_protocol_message.png" /&gt;&lt;/p&gt;
&lt;h2&gt;2 基本类型&lt;/h2&gt;
&lt;h3&gt;2.1 整型值&lt;/h3&gt;
&lt;p&gt;MySQL报文中整型值分别有1、2、3、4、8字节长度，使用小字节序传输。&lt;/p&gt;
&lt;h3&gt;2.2 字符串（以NULL结尾）（Null-Terminated String）&lt;/h3&gt;
&lt;p&gt;字符串长度不固定，当遇到'NULL'（0x00）字符时结束。&lt;/p&gt;
&lt;h3&gt;2.3 二进制数据（长度编码）（Length Coded Binary）&lt;/h3&gt;
&lt;p&gt;数据长度不固定，长度值由数据前的1-9个字节决定，其中长度值所占的字节数不定，字节数由第1个字节决定，如下表：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;第一个字节值&lt;/th&gt;
&lt;th&gt;后续字节数&lt;/th&gt;
&lt;th&gt;长度值说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0-250&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;第一个字节值即为数据的真实长度&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;251&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;空数据，数据的真实长度为零&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;252&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;后续额外2个字节标识了数据的真实长度&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;253&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;后续额外3个字节标识了数据的真实长度&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;254&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;后续额外8个字节标识了数据的真实长度&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;2.4 字符串（长度编码）（Length Coded String）&lt;/h3&gt;
&lt;p&gt;字符串长度不固定，无'NULL'（0x00）结束符，编码方式与上面的 Length Coded Binary 相同。&lt;/p&gt;
&lt;h2&gt;3 报文结构&lt;/h2&gt;
&lt;p&gt;报文分为消息头和消息体两部分，其中消息头占用固定的4个字节，消息体长度由消息头中的长度字段决定，报文结构如下：&lt;/p&gt;
&lt;!--
    ┏━━━━━━━━━━━━━━━━━━━━━━━━┯━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
    ┃                        │        ┃                                             ┃
    ┃         3 Bytes        │ 1 Byte ┃                   n Bytes                   ┃
    ┃                        │        ┃                                             ┃
    ┗━━━━━━━━━━━━━━━━━━━━━━━━┷━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
    |&lt;-       消息长度     -&gt;|&lt;-序号-&gt;|&lt;-                 报文数据                -&gt;|
    |                                 |                                             |
    |&lt;-             消息头          -&gt;|&lt;-                  消息体                 -&gt;|
--&gt;

&lt;p&gt;&lt;img alt="MySQL报文结构" src="/images/articles/201311/mysql_protocol_struct.png" /&gt;&lt;/p&gt;
&lt;h3&gt;3.1 消息头&lt;/h3&gt;
&lt;h4&gt;3.1.1 报文长度&lt;/h4&gt;
&lt;p&gt;用于标记当前请求消息的实际数据长度值，以字节为单位，占用3个字节，最大值为 0xFFFFFF，即接近 16 MB 大小（比16MB少1个字节）。&lt;/p&gt;
&lt;h4&gt;3.1.2 序号&lt;/h4&gt;
&lt;p&gt;在一次完整的请求/响应交互过程中，用于保证消息顺序的正确，每次客户端发起请求时，序号值都会从0开始计算。&lt;/p&gt;
&lt;h3&gt;3.2 消息体&lt;/h3&gt;
&lt;p&gt;消息体用于存放请求的内容及响应的数据，长度由消息头中的长度值决定。&lt;/p&gt;
&lt;h2&gt;4 报文类型&lt;/h2&gt;
&lt;h3&gt;4.1 登陆认证交互报文&lt;/h3&gt;
&lt;h4&gt;4.1.1 握手初始化报文（服务器 -&amp;gt; 客户端）&lt;/h4&gt;
&lt;!--
    0                                   16                                  32
    ┏━━━━━━━━━━━━━━━━━┯━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
    ┃     1 Byte      │          n Bytes (Null-Termimated String)           ┃
    ┃   协议版本号    │                服务器版本信息                       ┃
    ┣━━━━━━━━━━━━━━━━━┷━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
    ┃                                4 Bytes                                ┃
    ┃                              服务器线程ID                             ┃
    ┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
    ┃                                                                       ┃
    ┃                                8 Bytes                                ┃
    ┃                              挑战随机数                               ┃
    ┃                                                                       ┃
    ┣━━━━━━━━━━━━━━━━━┯━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┯━━━━━━━━━━━━━━━━━┫
    ┃     1 Byte      │              2 Bytes              │     1 Byte      ┃
    ┃   填充值(0x00)  │           服务器权能标志          │    字符编码     ┃
    ┣━━━━━━━━━━━━━━━━━┷━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┷━━━━━━━━━━━━━━━━━┫
    ┃              2 Bytes              ┃              2 Bytes              ┃
    ┃            服务器状态             ┃        服务器权能标志(高16位)     ┃
    ┣━━━━━━━━━━━━━━━━━┯━━━━━━━━━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
    ┃     1 Byte      │                                                     ┃
    ┃ 挑战长度(未使用)│                                                     ┃
    ┣━━━━━━━━━━━━━━━━━┷┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┫
    ┃                               10 Bytes                                ┃
    ┃                             填充值(0x00)                              ┃
    ┣┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┯━━━━━━━━━━━━━━━━━┫
    ┃                                                     │                 ┃
    ┃                                                     │                 ┃
    ┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┷┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┫
    ┃                                                                       ┃
    ┃                                                                       ┃
    ┣┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┫
    ┃                               n Bytes                                 ┃
    ┃                    挑战随机数(第二部分，至少12字节)                   ┃
    ┣┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┯━━━━━━━━━━━━━━━━━┫
    ┃                                                     │     1 Byte      ┃
    ┃                                                     │ 挑战数结束(0x00)┃
    ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┷━━━━━━━━━━━━━━━━━┛
--&gt;

&lt;p&gt;&lt;img alt="MySQL握手初始化报文" src="/images/articles/201311/mysql_protocol_handshake.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;服务协议版本号&lt;/strong&gt;：该值由 PROTOCOL_VERSION 宏定义决定（参考MySQL源代码&lt;code&gt;/include/mysql_version.h&lt;/code&gt;头文件定义）&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;服务版本信息&lt;/strong&gt;：该值为字符串，由 MYSQL_SERVER_VERSION 宏定义决定（参考MySQL源代码&lt;code&gt;/include/mysql_version.h&lt;/code&gt;头文件定义）&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;服务器线程ID&lt;/strong&gt;：服务器为当前连接所创建的线程ID。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;挑战随机数&lt;/strong&gt;：MySQL数据库用户认证采用的是挑战/应答的方式，服务器生成该挑战数并发送给客户端，由客户端进行处理并返回相应结果，然后服务器检查是否与预期的结果相同，从而完成用户认证的过程。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;服务器权能标志&lt;/strong&gt;：用于与客户端协商通讯方式，各标志位含义如下（参考MySQL源代码&lt;code&gt;/include/mysql_com.h&lt;/code&gt;中的宏定义）：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;标志位名称&lt;/th&gt;
&lt;th&gt;标志位&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;CLIENT_LONG_PASSWORD&lt;/td&gt;
&lt;td&gt;0x0001&lt;/td&gt;
&lt;td&gt;new more secure passwords&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CLIENT_FOUND_ROWS&lt;/td&gt;
&lt;td&gt;0x0002&lt;/td&gt;
&lt;td&gt;Found instead of affected rows&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CLIENT_LONG_FLAG&lt;/td&gt;
&lt;td&gt;0x0004&lt;/td&gt;
&lt;td&gt;Get all column flags&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CLIENT_CONNECT_WITH_DB&lt;/td&gt;
&lt;td&gt;0x0008&lt;/td&gt;
&lt;td&gt;One can specify db on connect&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CLIENT_NO_SCHEMA&lt;/td&gt;
&lt;td&gt;0x0010&lt;/td&gt;
&lt;td&gt;Do not allow database.table.column&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CLIENT_COMPRESS&lt;/td&gt;
&lt;td&gt;0x0020&lt;/td&gt;
&lt;td&gt;Can use compression protocol&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CLIENT_ODBC&lt;/td&gt;
&lt;td&gt;0x0040&lt;/td&gt;
&lt;td&gt;Odbc client&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CLIENT_LOCAL_FILES&lt;/td&gt;
&lt;td&gt;0x0080&lt;/td&gt;
&lt;td&gt;Can use LOAD DATA LOCAL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CLIENT_IGNORE_SPACE&lt;/td&gt;
&lt;td&gt;0x0100&lt;/td&gt;
&lt;td&gt;Ignore spaces before '('&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CLIENT_PROTOCOL_41&lt;/td&gt;
&lt;td&gt;0x0200&lt;/td&gt;
&lt;td&gt;New 4.1 protocol&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CLIENT_INTERACTIVE&lt;/td&gt;
&lt;td&gt;0x0400&lt;/td&gt;
&lt;td&gt;This is an interactive client&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CLIENT_SSL&lt;/td&gt;
&lt;td&gt;0x0800&lt;/td&gt;
&lt;td&gt;Switch to SSL after handshake&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CLIENT_IGNORE_SIGPIPE&lt;/td&gt;
&lt;td&gt;0x1000&lt;/td&gt;
&lt;td&gt;IGNORE sigpipes&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CLIENT_TRANSACTIONS&lt;/td&gt;
&lt;td&gt;0x2000&lt;/td&gt;
&lt;td&gt;Client knows about transactions&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CLIENT_RESERVED&lt;/td&gt;
&lt;td&gt;0x4000&lt;/td&gt;
&lt;td&gt;Old flag for 4.1 protocol&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CLIENT_SECURE_CONNECTION&lt;/td&gt;
&lt;td&gt;0x8000&lt;/td&gt;
&lt;td&gt;New 4.1 authentication&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CLIENT_MULTI_STATEMENTS&lt;/td&gt;
&lt;td&gt;0x0001 0000&lt;/td&gt;
&lt;td&gt;Enable/disable multi-stmt support&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CLIENT_MULTI_RESULTS&lt;/td&gt;
&lt;td&gt;0x0002 0000&lt;/td&gt;
&lt;td&gt;Enable/disable multi-results&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;字符编码&lt;/strong&gt;：标识服务器所使用的字符集。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;服务器状态&lt;/strong&gt;：状态值定义如下（参考MySQL源代码&lt;code&gt;/include/mysql_com.h&lt;/code&gt;中的宏定义）：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;状态名称&lt;/th&gt;
&lt;th&gt;状态值&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;SERVER_STATUS_IN_TRANS&lt;/td&gt;
&lt;td&gt;0x0001&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SERVER_STATUS_AUTOCOMMIT&lt;/td&gt;
&lt;td&gt;0x0002&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SERVER_STATUS_CURSOR_EXISTS&lt;/td&gt;
&lt;td&gt;0x0040&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SERVER_STATUS_LAST_ROW_SENT&lt;/td&gt;
&lt;td&gt;0x0080&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SERVER_STATUS_DB_DROPPED&lt;/td&gt;
&lt;td&gt;0x0100&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SERVER_STATUS_NO_BACKSLASH_ESCAPES&lt;/td&gt;
&lt;td&gt;0x0200&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SERVER_STATUS_METADATA_CHANGED&lt;/td&gt;
&lt;td&gt;0x0400&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;4.1.2 登陆认证报文（客户端 -&amp;gt; 服务器）&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt; MySQL 4.0 及之前的版本&lt;/strong&gt;&lt;/p&gt;
&lt;!--
    0                                   16                                  32
    ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
    ┃              2 Bytes              ┃              3 Bytes              ┋
    ┃           客户端权能标志          ┃           最大消息长度            ┋
    ┣━━━━━━━━━━━━━━━━━┯━━━━━━━━━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
    ┋                 │                                                     ┃
    ┋                 │                                                     ┃
    ┣━━━━━━━━━━━━━━━━━┷┉┉┉┉┉┉┉┉┉┉┉┉ n Bytes ┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┫
    ┃                     用户名(Null-Terminated String)                    ┃
    ┃                                                                       ┃
    ┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
    ┃                                                                       ┃
    ┃                                                                       ┃
    ┣┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉ 8 Bytes ┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┫
    ┃                   挑战认证数据(Length Coded Binary)                   ┃
    ┃                                                                       ┃
    ┣━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
    ┃      1 Byte     ┃
    ┃  数据结束(0x00) ┃
    ┗━━━━━━━━━━━━━━━━━┛
--&gt;

&lt;p&gt;&lt;img alt="MySQL登陆认证报文(4.0及之前的版本)" src="/images/articles/201311/mysql_protocol_auth_40.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt; MySQL 4.1 及之后的版本&lt;/strong&gt;&lt;/p&gt;
&lt;!--
    0                                   16                                  32
    ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
    ┃              2 Bytes              ┃              2 Bytes              ┃
    ┃           客户端权能标志          ┃        客户端权能标志（扩展）     ┃
    ┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
    ┃                                4 Bytes                                ┃
    ┃                             最大消息长度                              ┃
    ┣━━━━━━━━━━━━━━━━━┯━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
    ┃     1 Byte      │                                                     ┃
    ┃    字符编码     │                                                     ┃
    ┣━━━━━━━━━━━━━━━━━┷┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┫
    ┃                                                                       ┃
    ┃                                                                       ┃
    ┣┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┫
    ┃                                                                       ┃
    ┃                                                                       ┃
    ┣┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉ 23 Bytes ┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┫
    ┃                            填充值(0x00)                               ┃
    ┃                                                                       ┃
    ┣┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┫
    ┃                                                                       ┃
    ┃                                                                       ┃
    ┣┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┉┫
    ┃                                                                       ┃
    ┃                                                                       ┃
    ┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
    ┃                               n Bytes                                 ┃
    ┃                     用户名(Null-Terminated String)                    ┃
    ┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
    ┃                               n Bytes                                 ┃
    ┃                   挑战认证数据(Length Coded Binary)                   ┃
    ┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
    ┃                               n Bytes                                 ┃
    ┃                 数据库名称(Null-Terminated String)(可选)              ┃
    ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
--&gt;

&lt;p&gt;&lt;img alt="MySQL登陆认证报文(4.1及之后的版本)" src="/images/articles/201311/mysql_protocol_auth_41.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;客户端权能标志&lt;/strong&gt;：用于与客户端协商通讯方式，标志位含义与握手初始化报文中的相同。客户端收到服务器发来的初始化报文后，会对服务器发送的权能标志进行修改，保留自身所支持的功能，然后将权能标返回给服务器，从而保证服务器与客户端通讯的兼容性。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;最大消息长度&lt;/strong&gt;：客户端发送请求报文时所支持的最大消息长度值。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;字符编码&lt;/strong&gt;：标识通讯过程中使用的字符编码，与服务器在认证初始化报文中发送的相同。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;用户名&lt;/strong&gt;：客户端登陆用户的用户名称。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;挑战认证数据&lt;/strong&gt;：客户端用户密码使用服务器发送的挑战随机数进行加密后，生成挑战认证数据，然后返回给服务器，用于对用户身份的认证。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;数据库名称&lt;/strong&gt;：当客户端的权能标志位 CLIENT_CONNECT_WITH_DB 被置位时，该字段必须出现。&lt;/p&gt;
&lt;h3&gt;4.2 客户端命令请求报文（客户端 -&amp;gt; 服务器）&lt;/h3&gt;
&lt;!--
    ┏━━━━━━━━━━━━━━━━┯━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
    ┃                │                                                              ┃
    ┃     1 Byte     │                         n Bytes                              ┃
    ┃                │                                                              ┃
    ┗━━━━━━━━━━━━━━━━┷━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
    |&lt;-    命令    -&gt;|&lt;-                        参数                              -&gt;|
    |                                                                               |
    |&lt;-                                消息体                                     -&gt;|
--&gt;

&lt;p&gt;&lt;img alt="MySQL客户端命令请求报文" src="/images/articles/201311/mysql_protocol_command.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;命令&lt;/strong&gt;：用于标识当前请求消息的类型，例如切换数据库（0x02）、查询命令（0x03）等。命令值的取值范围及说明如下表（参考MySQL源代码&lt;code&gt;/include/mysql_com.h&lt;/code&gt;头文件中的定义）：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;类型值&lt;/th&gt;
&lt;th&gt;命令&lt;/th&gt;
&lt;th&gt;功能&lt;/th&gt;
&lt;th&gt;关联函数&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0x00&lt;/td&gt;
&lt;td&gt;COM_SLEEP&lt;/td&gt;
&lt;td&gt;（内部线程状态）&lt;/td&gt;
&lt;td&gt;（无）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x01&lt;/td&gt;
&lt;td&gt;COM_QUIT&lt;/td&gt;
&lt;td&gt;关闭连接&lt;/td&gt;
&lt;td&gt;mysql_close&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x02&lt;/td&gt;
&lt;td&gt;COM_INIT_DB&lt;/td&gt;
&lt;td&gt;切换数据库&lt;/td&gt;
&lt;td&gt;mysql_select_db&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x03&lt;/td&gt;
&lt;td&gt;COM_QUERY&lt;/td&gt;
&lt;td&gt;SQL查询请求&lt;/td&gt;
&lt;td&gt;mysql_real_query&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x04&lt;/td&gt;
&lt;td&gt;COM_FIELD_LIST&lt;/td&gt;
&lt;td&gt;获取数据表字段信息&lt;/td&gt;
&lt;td&gt;mysql_list_fields&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x05&lt;/td&gt;
&lt;td&gt;COM_CREATE_DB&lt;/td&gt;
&lt;td&gt;创建数据库&lt;/td&gt;
&lt;td&gt;mysql_create_db&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x06&lt;/td&gt;
&lt;td&gt;COM_DROP_DB&lt;/td&gt;
&lt;td&gt;删除数据库&lt;/td&gt;
&lt;td&gt;mysql_drop_db&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x07&lt;/td&gt;
&lt;td&gt;COM_REFRESH&lt;/td&gt;
&lt;td&gt;清除缓存&lt;/td&gt;
&lt;td&gt;mysql_refresh&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x08&lt;/td&gt;
&lt;td&gt;COM_SHUTDOWN&lt;/td&gt;
&lt;td&gt;停止服务器&lt;/td&gt;
&lt;td&gt;mysql_shutdown&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x09&lt;/td&gt;
&lt;td&gt;COM_STATISTICS&lt;/td&gt;
&lt;td&gt;获取服务器统计信息&lt;/td&gt;
&lt;td&gt;mysql_stat&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0A&lt;/td&gt;
&lt;td&gt;COM_PROCESS_INFO&lt;/td&gt;
&lt;td&gt;获取当前连接的列表&lt;/td&gt;
&lt;td&gt;mysql_list_processes&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0B&lt;/td&gt;
&lt;td&gt;COM_CONNECT&lt;/td&gt;
&lt;td&gt;（内部线程状态）&lt;/td&gt;
&lt;td&gt;（无）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0C&lt;/td&gt;
&lt;td&gt;COM_PROCESS_KILL&lt;/td&gt;
&lt;td&gt;中断某个连接&lt;/td&gt;
&lt;td&gt;mysql_kill&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0D&lt;/td&gt;
&lt;td&gt;COM_DEBUG&lt;/td&gt;
&lt;td&gt;保存服务器调试信息&lt;/td&gt;
&lt;td&gt;mysql_dump_debug_info&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0E&lt;/td&gt;
&lt;td&gt;COM_PING&lt;/td&gt;
&lt;td&gt;测试连通性&lt;/td&gt;
&lt;td&gt;mysql_ping&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0F&lt;/td&gt;
&lt;td&gt;COM_TIME&lt;/td&gt;
&lt;td&gt;（内部线程状态）&lt;/td&gt;
&lt;td&gt;（无）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x10&lt;/td&gt;
&lt;td&gt;COM_DELAYED_INSERT&lt;/td&gt;
&lt;td&gt;（内部线程状态）&lt;/td&gt;
&lt;td&gt;（无）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x11&lt;/td&gt;
&lt;td&gt;COM_CHANGE_USER&lt;/td&gt;
&lt;td&gt;重新登陆（不断连接）&lt;/td&gt;
&lt;td&gt;mysql_change_user&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x12&lt;/td&gt;
&lt;td&gt;COM_BINLOG_DUMP&lt;/td&gt;
&lt;td&gt;获取二进制日志信息&lt;/td&gt;
&lt;td&gt;（无）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x13&lt;/td&gt;
&lt;td&gt;COM_TABLE_DUMP&lt;/td&gt;
&lt;td&gt;获取数据表结构信息&lt;/td&gt;
&lt;td&gt;（无）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x14&lt;/td&gt;
&lt;td&gt;COM_CONNECT_OUT&lt;/td&gt;
&lt;td&gt;（内部线程状态）&lt;/td&gt;
&lt;td&gt;（无）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x15&lt;/td&gt;
&lt;td&gt;COM_REGISTER_SLAVE&lt;/td&gt;
&lt;td&gt;从服务器向主服务器进行注册&lt;/td&gt;
&lt;td&gt;（无）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x16&lt;/td&gt;
&lt;td&gt;COM_STMT_PREPARE&lt;/td&gt;
&lt;td&gt;预处理SQL语句&lt;/td&gt;
&lt;td&gt;mysql_stmt_prepare&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x17&lt;/td&gt;
&lt;td&gt;COM_STMT_EXECUTE&lt;/td&gt;
&lt;td&gt;执行预处理语句&lt;/td&gt;
&lt;td&gt;mysql_stmt_execute&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x18&lt;/td&gt;
&lt;td&gt;COM_STMT_SEND_LONG_DATA&lt;/td&gt;
&lt;td&gt;发送BLOB类型的数据&lt;/td&gt;
&lt;td&gt;mysql_stmt_send_long_data&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x19&lt;/td&gt;
&lt;td&gt;COM_STMT_CLOSE&lt;/td&gt;
&lt;td&gt;销毁预处理语句&lt;/td&gt;
&lt;td&gt;mysql_stmt_close&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x1A&lt;/td&gt;
&lt;td&gt;COM_STMT_RESET&lt;/td&gt;
&lt;td&gt;清除预处理语句参数缓存&lt;/td&gt;
&lt;td&gt;mysql_stmt_reset&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x1B&lt;/td&gt;
&lt;td&gt;COM_SET_OPTION&lt;/td&gt;
&lt;td&gt;设置语句选项&lt;/td&gt;
&lt;td&gt;mysql_set_server_option&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x1C&lt;/td&gt;
&lt;td&gt;COM_STMT_FETCH&lt;/td&gt;
&lt;td&gt;获取预处理语句的执行结果&lt;/td&gt;
&lt;td&gt;mysql_stmt_fetch&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;参数&lt;/strong&gt;：内容是用户在MySQL客户端输入的命令（不包括每行命令结尾的";"分号）。另外这个字段的字符串不是以NULL字符结尾，而是通过消息头中的长度值计算而来。&lt;/p&gt;
&lt;p&gt;例如：当我们在MySQL客户端中执行&lt;code&gt;use hutaow;&lt;/code&gt;命令时（切换到&lt;code&gt;hutaow&lt;/code&gt;数据库），发送的请求报文数据会是下面的样子：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="mh"&gt;0x02&lt;/span&gt; &lt;span class="mh"&gt;0x68&lt;/span&gt; &lt;span class="mh"&gt;0x75&lt;/span&gt; &lt;span class="mh"&gt;0x74&lt;/span&gt; &lt;span class="mh"&gt;0x61&lt;/span&gt; &lt;span class="mh"&gt;0x6f&lt;/span&gt; &lt;span class="mh"&gt;0x77&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;其中，&lt;code&gt;0x02&lt;/code&gt;为请求类型值&lt;code&gt;COM_INIT_DB&lt;/code&gt;，后面的&lt;code&gt;0x68 0x75 0x74 0x61 0x6f 0x77&lt;/code&gt;为ASCII字符&lt;code&gt;hutaow&lt;/code&gt;。&lt;/p&gt;
&lt;h4&gt;4.2.1 COM_QUIT 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：关闭当前连接（客户端退出），无参数。&lt;/p&gt;
&lt;h4&gt;4.2.2 COM_INIT_DB 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：切换数据库，对应的SQL语句为&lt;code&gt;USE &amp;lt;database&amp;gt;&lt;/code&gt;。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;数据库名称（字符串到达消息尾部时结束，无结束符）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;4.2.3 COM_QUERY 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：最常见的请求消息类型，当用户执行SQL语句时发送该消息。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;SQL语句（字符串到达消息尾部时结束，无结束符）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;4.2.4 COM_FIELD_LIST 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：查询某表的字段（列）信息，等同于SQL语句&lt;code&gt;SHOW [FULL] FIELDS FROM ...&lt;/code&gt;。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;表格名称（Null-Terminated String）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;字段（列）名称或通配符（可选）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;4.2.5 COM_CREATE_DB 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：创建数据库，该消息已过时，而被SQL语句&lt;code&gt;CREATE DATABASE&lt;/code&gt;代替。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;数据库名称（字符串到达消息尾部时结束，无结束符）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;4.2.6 COM_DROP_DB 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：删除数据库，该消息已过时，而被SQL语句&lt;code&gt;DROP DATABASE&lt;/code&gt;代替。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;数据库名称（字符串到达消息尾部时结束，无结束符）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;4.2.7 COM_REFRESH 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：清除缓存，等同于SQL语句&lt;code&gt;FLUSH&lt;/code&gt;，或是执行&lt;code&gt;mysqladmin flush-foo&lt;/code&gt;命令时发送该消息。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;清除缓存选项（位图方式存储，各标志位含义如下）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;0x01: REFRESH_GRANT&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;0x02: REFRESH_LOG&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;0x04: REFRESH_TABLES&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;0x08: REFRESH_HOSTS&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;0x10: REFRESH_STATUS&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;0x20: REFRESH_THREADS&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;0x40: REFRESH_SLAVE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;0x80: REFRESH_MASTER&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;4.2.8 COM_SHUTDOWN 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：停止MySQL服务。执行&lt;code&gt;mysqladmin shutdown&lt;/code&gt;命令时发送该消息。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;停止服务选项&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;0x00: SHUTDOWN_DEFAULT&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;0x01: SHUTDOWN_WAIT_CONNECTIONS&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;0x02: SHUTDOWN_WAIT_TRANSACTIONS&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;0x08: SHUTDOWN_WAIT_UPDATES&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;0x10: SHUTDOWN_WAIT_ALL_BUFFERS&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;0x11: SHUTDOWN_WAIT_CRITICAL_BUFFERS&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;0xFE: KILL_QUERY&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;0xFF: KILL_CONNECTION&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;4.2.9 COM_STATISTICS 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：查看MySQL服务的统计信息（例如运行时间、每秒查询次数等）。执行&lt;code&gt;mysqladmin status&lt;/code&gt;命令时发送该消息，无参数。&lt;/p&gt;
&lt;h4&gt;4.2.10 COM_PROCESS_INFO 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：获取当前活动的线程（连接）列表。等同于SQL语句&lt;code&gt;SHOW PROCESSLIST&lt;/code&gt;，或是执行&lt;code&gt;mysqladmin processlist&lt;/code&gt;命令时发送该消息，无参数。&lt;/p&gt;
&lt;h4&gt;4.2.11 COM_PROCESS_KILL 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：要求服务器中断某个连接。等同于SQL语句&lt;code&gt;KILL &amp;lt;id&amp;gt;&lt;/code&gt;。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;连接ID号（小字节序）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;4.2.12 COM_DEBUG 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：要求服务器将调试信息保存下来，保存的信息多少依赖于编译选项设置（debug=no|yes|full）。执行&lt;code&gt;mysqladmin debug&lt;/code&gt;命令时发送该消息，无参数。&lt;/p&gt;
&lt;h4&gt;4.2.13 COM_PING 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：该消息用来测试连通性，同时会将服务器的无效连接（超时）计数器清零。执行&lt;code&gt;mysqladmin ping&lt;/code&gt;命令时发送该消息，无参数。&lt;/p&gt;
&lt;h4&gt;4.2.14 COM_CHANGE_USER 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：在不断连接的情况下重新登陆，该操作会销毁MySQL服务器端的会话上下文（包括临时表、会话变量等）。有些连接池用这种方法实现清除会话上下文。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;用户名（字符串以NULL结尾）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;密码（挑战数）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;MySQL 3.23 版本：Null-Terminated String（长度9字节）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;MySQL 4.1 版本：Length Coded String（长度1+21字节）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;数据库名称（Null-Terminated String）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;字符编码&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;4.2.15 COM_BINLOG_DUMP 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：该消息是备份连接时由从服务器向主服务器发送的最后一个请求，主服务器收到后，会响应一系列的报文，每个报文都包含一个二进制日志事件。如果主服务器出现故障时，会发送一个EOF报文。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;二进制日志数据的起始位置（小字节序）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;二进制日志数据标志位（目前未使用，永远为0x00）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;从服务器的服务器ID值（小字节序）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;二进制日志的文件名称（可选，默认值为主服务器上第一个有效的文件名）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;4.2.16 COM_TABLE_DUMP 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：将数据表从主服务器复制到从服务器中，执行SQL语句&lt;code&gt;LOAD TABLE ... FROM MASTER&lt;/code&gt;时发送该消息。目前该消息已过时，不再使用。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;数据库名称（Length Coded String）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;数据表名称（Length Coded String）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;4.2.17 COM_REGISTER_SLAVE 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：在从服务器&lt;code&gt;report_host&lt;/code&gt;变量设置的情况下，当备份连接时向主服务器发送的注册消息。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;从服务器ID值（小字节序）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;主服务器IP地址（Length Coded String）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;主服务器用户名（Length Coded String）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;主服务器密码（Length Coded String）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;主服务器端口号&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;安全备份级别（由MySQL服务器&lt;code&gt;rpl_recovery_rank&lt;/code&gt;变量设置，暂时未使用）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;主服务器ID值（值恒为0x00）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;4.2.18 COM_PREPARE 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：预处理SQL语句，使用带有"?"占位符的SQL语句时发送该消息。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;带有"?"占位符的SQL语句（字符串到达消息尾部时结束，无结束符）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;4.2.19 COM_EXECUTE 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：执行预处理语句。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;预处理语句的ID值&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;标志位&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;0x00: CURSOR_TYPE_NO_CURSOR&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;0x01: CURSOR_TYPE_READ_ONLY&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;0x02: CURSOR_TYPE_FOR_UPDATE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;0x04: CURSOR_TYPE_SCROLLABLE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;保留（值恒为0x01）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;如果参数数量大于0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;空位图（Null-Bitmap，长度 = (参数数量 + 7) / 8 字节）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;参数分隔标志&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;如果参数分隔标志值为1&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;每个参数的类型值（长度 = 参数数量 * 2 字节）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;每个参数的值&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;4.2.20 COM_LONG_DATA 消息报文&lt;/h4&gt;
&lt;p&gt;该消息报文有两种形式，一种用于发送二进制数据，另一种用于发送文本数据。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：用于发送二进制（BLOB）类型的数据（调用&lt;code&gt;mysql_stmt_send_long_data&lt;/code&gt;函数）。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;预处理语句的ID值（小字节序）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;参数序号（小字节序）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;数据负载（数据到达消息尾部时结束，无结束符）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：用于发送超长字符串类型的数据（调用&lt;code&gt;mysql_send_long_data&lt;/code&gt;函数）&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;预处理语句的ID值（小字节序）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;参数序号（小字节序）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;数据类型（未使用）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;数据负载（数据到达消息尾部时结束，无结束符）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;4.2.21 COM_CLOSE_STMT 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：销毁预处理语句。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;预处理语句的ID值（小字节序）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;4.2.22 COM_RESET_STMT 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：将预处理语句的参数缓存清空。多数情况和&lt;code&gt;COM_LONG_DATA&lt;/code&gt;一起使用。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;预处理语句的ID值（小字节序）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;4.2.23 COM_SET_OPTION 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：设置语句选项，选项值为&lt;code&gt;/include/mysql_com.h&lt;/code&gt;头文件中定义的&lt;code&gt;enum_mysql_set_option&lt;/code&gt;枚举类型：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MYSQL_OPTION_MULTI_STATEMENTS_ON&lt;/li&gt;
&lt;li&gt;MYSQL_OPTION_MULTI_STATEMENTS_OFF&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;选项值（小字节序）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;4.2.24 COM_FETCH_STMT 消息报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;功能&lt;/strong&gt;：获取预处理语句的执行结果（一次可以获取多行数据）。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;预处理语句的ID值（小字节序）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;数据的行数（小字节序）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;4.3 服务器响应报文（服务器 -&amp;gt; 客户端）&lt;/h3&gt;
&lt;p&gt;当客户端发起认证请求或命令请求后，服务器会返回相应的执行结果给客户端。客户端在收到响应报文后，需要首先检查第1个字节的值，来区分响应报文的类型。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;响应报文类型&lt;/th&gt;
&lt;th&gt;第1个字节取值范围&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;OK 响应报文&lt;/td&gt;
&lt;td&gt;0x00&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Error 响应报文&lt;/td&gt;
&lt;td&gt;0xFF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Result Set 报文&lt;/td&gt;
&lt;td&gt;0x01 - 0xFA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Field 报文&lt;/td&gt;
&lt;td&gt;0x01 - 0xFA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Row Data 报文&lt;/td&gt;
&lt;td&gt;0x01 - 0xFA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;EOF 报文&lt;/td&gt;
&lt;td&gt;0xFE&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;注：响应报文的第1个字节在不同类型中含义不同，比如在OK报文中，该字节并没有实际意义，值恒为0x00；而在Result Set报文中，该字节又是长度编码的二进制数据结构（Length Coded Binary）中的第1字节。&lt;/p&gt;
&lt;h4&gt;4.3.1 OK 响应报文&lt;/h4&gt;
&lt;p&gt;客户端的命令执行正确时，服务器会返回OK响应报文。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt; MySQL 4.0 及之前的版本&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;OK报文，值恒为0x00&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1-9&lt;/td&gt;
&lt;td&gt;受影响行数（Length Coded Binary）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1-9&lt;/td&gt;
&lt;td&gt;索引ID值（Length Coded Binary）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;服务器状态&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;服务器消息（字符串到达消息尾部时结束，无结束符）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt; MySQL 4.1 及之后的版本&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;OK报文，值恒为0x00&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1-9&lt;/td&gt;
&lt;td&gt;受影响行数（Length Coded Binary）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1-9&lt;/td&gt;
&lt;td&gt;索引ID值（Length Coded Binary）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;服务器状态&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;告警计数&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;服务器消息（字符串到达消息尾部时结束，无结束符，可选）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;受影响行数&lt;/strong&gt;：当执行&lt;code&gt;INSERT&lt;/code&gt;/&lt;code&gt;UPDATE&lt;/code&gt;/&lt;code&gt;DELETE&lt;/code&gt;语句时所影响的数据行数。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;索引ID值&lt;/strong&gt;：该值为&lt;code&gt;AUTO_INCREMENT&lt;/code&gt;索引字段生成，如果没有索引字段，则为0x00。注意：当&lt;code&gt;INSERT&lt;/code&gt;插入语句为多行数据时，该索引ID值为第一个插入的数据行索引值，而非最后一个。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;服务器状态&lt;/strong&gt;：客户端可以通过该值检查命令是否在事务处理中。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;告警计数&lt;/strong&gt;：告警发生的次数。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;服务器消息&lt;/strong&gt;：服务器返回给客户端的消息，一般为简单的描述性字符串，可选字段。&lt;/p&gt;
&lt;h4&gt;4.3.2 Error 响应报文&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt; MySQL 4.0 及之前的版本&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;Error报文，值恒为0xFF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;错误编号（小字节序）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;服务器消息&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt; MySQL 4.1 及之后的版本&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;Error报文，值恒为0xFF&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;错误编号（小字节序）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;服务器状态标志，恒为'#'字符&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;服务器状态（5个字符）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;服务器消息&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;错误编号&lt;/strong&gt;：错误编号值定义在源代码&lt;code&gt;/include/mysqld_error.h&lt;/code&gt;头文件中。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;服务器状态&lt;/strong&gt;：服务器将错误编号通过&lt;code&gt;mysql_errno_to_sqlstate&lt;/code&gt;函数转换为状态值，状态值由5字节的ASCII字符组成，定义在源代码&lt;code&gt;/include/sql_state.h&lt;/code&gt;头文件中。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;服务器消息&lt;/strong&gt;：错误消息字符串到达消息尾时结束，长度可以由消息头中的长度值计算得出。消息长度为0-512字节。&lt;/p&gt;
&lt;h4&gt;4.3.3 Result Set 消息&lt;/h4&gt;
&lt;p&gt;当客户端发送查询请求后，在没有错误的情况下，服务器会返回结果集（Result Set）给客户端。&lt;/p&gt;
&lt;p&gt;Result Set 消息分为五部分，结构如下：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;结构&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;[Result Set Header]&lt;/td&gt;
&lt;td&gt;列数量&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;[Field]&lt;/td&gt;
&lt;td&gt;列信息（多个）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;[EOF]&lt;/td&gt;
&lt;td&gt;列结束&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;[Row Data]&lt;/td&gt;
&lt;td&gt;行数据（多个）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;[EOF]&lt;/td&gt;
&lt;td&gt;数据结束&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;4.3.4 Result Set Header 结构&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1-9&lt;/td&gt;
&lt;td&gt;Field结构计数（Length Coded Binary）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1-9&lt;/td&gt;
&lt;td&gt;额外信息（Length Coded Binary）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Field结构计数&lt;/strong&gt;：用于标识Field结构的数量，取值范围0x00-0xFA。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;额外信息&lt;/strong&gt;：可选字段，一般情况下不应该出现。只有像&lt;code&gt;SHOW COLUMNS&lt;/code&gt;这种语句的执行结果才会用到额外信息（标识表格的列数量）。&lt;/p&gt;
&lt;h4&gt;4.3.5 Field 结构&lt;/h4&gt;
&lt;p&gt;Field为数据表的列信息，在Result Set中，Field会连续出现多次，次数由Result Set Header结构中的IField结构计数值决定。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt; MySQL 4.0 及之前的版本&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;数据表名称（Length Coded String）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;列（字段）名称（Length Coded String）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;列（字段）长度（Length Coded String）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;列（字段）类型（Length Coded String）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;列（字段）标志（Length Coded String）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;整型值精度&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;默认值（Length Coded String）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt; MySQL 4.1 及之后的版本&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;目录名称（Length Coded String）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;数据库名称（Length Coded String）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;数据表名称（Length Coded String）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;数据表原始名称（Length Coded String）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;列（字段）名称（Length Coded String）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;列（字段）原始名称（Length Coded String）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;填充值&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;字符编码&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;列（字段）长度&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;列（字段）类型&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;列（字段）标志&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;整型值精度&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;填充值（0x00）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;默认值（Length Coded String）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;目录名称&lt;/strong&gt;：在4.1及之后的版本中，该字段值为"def"。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;数据库名称&lt;/strong&gt;：数据库名称标识。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;数据表名称&lt;/strong&gt;：数据表的别名（&lt;code&gt;AS&lt;/code&gt;之后的名称）。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;数据表原始名称&lt;/strong&gt;：数据表的原始名称（&lt;code&gt;AS&lt;/code&gt;之前的名称）。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;列（字段）名称&lt;/strong&gt;：列（字段）的别名（&lt;code&gt;AS&lt;/code&gt;之后的名称）。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;列（字段）原始名称&lt;/strong&gt;：列（字段）的原始名称（&lt;code&gt;AS&lt;/code&gt;之前的名称）。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;字符编码&lt;/strong&gt;：列（字段）的字符编码值。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;列（字段）长度&lt;/strong&gt;：列（字段）的长度值，真实长度可能小于该值，例如&lt;code&gt;VARCHAR(2)&lt;/code&gt;类型的字段实际只能存储1个字符。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;列（字段）类型&lt;/strong&gt;：列（字段）的类型值，取值范围如下（参考源代码&lt;code&gt;/include/mysql_com.h&lt;/code&gt;头文件中的&lt;code&gt;enum_field_type&lt;/code&gt;枚举类型定义）：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;类型值&lt;/th&gt;
&lt;th&gt;名称&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0x00&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_DECIMAL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x01&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_TINY&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x02&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_SHORT&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x03&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_LONG&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x04&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_FLOAT&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x05&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_DOUBLE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x06&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_NULL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x07&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_TIMESTAMP&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x08&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_LONGLONG&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x09&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_INT24&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0A&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_DATE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0B&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_TIME&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0C&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_DATETIME&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0D&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_YEAR&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0E&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_NEWDATE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0F&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_VARCHAR (new in MySQL 5.0)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x10&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_BIT (new in MySQL 5.0)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0xF6&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_NEWDECIMAL (new in MYSQL 5.0)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0xF7&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_ENUM&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0xF8&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_SET&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0xF9&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_TINY_BLOB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0xFA&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_MEDIUM_BLOB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0xFB&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_LONG_BLOB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0xFC&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_BLOB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0xFD&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_VAR_STRING&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0xFE&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_STRING&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0xFF&lt;/td&gt;
&lt;td&gt;FIELD_TYPE_GEOMETRY&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;列（字段）标志&lt;/strong&gt;：各标志位定义如下（参考源代码&lt;code&gt;/include/mysql_com.h&lt;/code&gt;头文件中的宏定义）：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;标志位&lt;/th&gt;
&lt;th&gt;名称&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0x0001&lt;/td&gt;
&lt;td&gt;NOT_NULL_FLAG&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0002&lt;/td&gt;
&lt;td&gt;PRI_KEY_FLAG&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0004&lt;/td&gt;
&lt;td&gt;UNIQUE_KEY_FLAG&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0008&lt;/td&gt;
&lt;td&gt;MULTIPLE_KEY_FLAG&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0010&lt;/td&gt;
&lt;td&gt;BLOB_FLAG&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0020&lt;/td&gt;
&lt;td&gt;UNSIGNED_FLAG&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0040&lt;/td&gt;
&lt;td&gt;ZEROFILL_FLAG&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0080&lt;/td&gt;
&lt;td&gt;BINARY_FLAG&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0100&lt;/td&gt;
&lt;td&gt;ENUM_FLAG&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0200&lt;/td&gt;
&lt;td&gt;AUTO_INCREMENT_FLAG&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0400&lt;/td&gt;
&lt;td&gt;TIMESTAMP_FLAG&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0x0800&lt;/td&gt;
&lt;td&gt;SET_FLAG&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;数值精度&lt;/strong&gt;：该字段对&lt;code&gt;DECIMAL&lt;/code&gt;和&lt;code&gt;NUMERIC&lt;/code&gt;类型的数值字段有效，用于标识数值的精度（小数点位置）。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;默认值&lt;/strong&gt;：该字段用在数据表定义中，普通的查询结果中不会出现。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;附&lt;/strong&gt;：Field结构的相关处理函数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;客户端：&lt;code&gt;/client/client.c&lt;/code&gt;源文件中的&lt;code&gt;unpack_fields&lt;/code&gt;函数&lt;/li&gt;
&lt;li&gt;服务器：&lt;code&gt;/sql/sql_base.cc&lt;/code&gt;源文件中的&lt;code&gt;send_fields&lt;/code&gt;函数&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;4.3.6 EOF 结构&lt;/h4&gt;
&lt;p&gt;EOF结构用于标识Field和Row Data的结束，在预处理语句中，EOF也被用来标识参数的结束。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt; MySQL 4.0 及之前的版本&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;EOF值（0xFE）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt; MySQL 4.1 及之后的版本&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;EOF值（0xFE）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;告警计数&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;状态标志位&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;告警计数&lt;/strong&gt;：服务器告警数量，在所有数据都发送给客户端后该值才有效。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;状态标志位&lt;/strong&gt;：包含类似&lt;code&gt;SERVER_MORE_RESULTS_EXISTS&lt;/code&gt;这样的标志位。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;注&lt;/strong&gt;：由于EOF值与其它Result Set结构共用1字节，所以在收到报文后需要对EOF包的真实性进行校验，校验条件为：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;第1字节值为0xFE&lt;/li&gt;
&lt;li&gt;包长度小于9字节&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;附&lt;/strong&gt;：EOF结构的相关处理函数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;服务器：&lt;code&gt;protocol.cc&lt;/code&gt;源文件中的&lt;code&gt;send_eof&lt;/code&gt;函数&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;4.3.7 Row Data 结构&lt;/h4&gt;
&lt;p&gt;在Result Set消息中，会包含多个Row Data结构，每个Row Data结构又包含多个字段值，这些字段值组成一行数据。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;字段值（Length Coded String）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;...&lt;/td&gt;
&lt;td&gt;（一行数据中包含多个字段值）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;字段值&lt;/strong&gt;：行数据中的字段值，字符串形式。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;附&lt;/strong&gt;：Row Data结构的相关处理函数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;客户端：&lt;code&gt;/client/client.c&lt;/code&gt;源文件中的&lt;code&gt;read_rows&lt;/code&gt;函数&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;4.3.8 Row Data 结构（二进制数据）&lt;/h4&gt;
&lt;p&gt;该结构用于传输二进制的字段值，既可以是服务器返回的结果，也可以是由客户端发送的（当执行预处理语句时，客户端使用Result Set消息来发送参数及数据）。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;结构头（0x00）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;(列数量 + 7 + 2) / 8&lt;/td&gt;
&lt;td&gt;空位图&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;字段值&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;...&lt;/td&gt;
&lt;td&gt;（一行数据中包含多个字段值）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;空位图&lt;/strong&gt;：前2个比特位被保留，值分别为0和1，以保证不会和OK、Error包的首字节冲突。在MySQL 5.0及之后的版本中，这2个比特位的值都为0。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;字段值&lt;/strong&gt;：行数据中的字段值，二进制形式。&lt;/p&gt;
&lt;h4&gt;4.3.9 PREPARE_OK 响应报文（Prepared Statement）&lt;/h4&gt;
&lt;p&gt;用于响应客户端发起的预处理语句报文，组成结构如下：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;结构&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;[PREPARE_OK]&lt;/td&gt;
&lt;td&gt;PREPARE_OK结构&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;如果参数数量大于0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;[Field]&lt;/td&gt;
&lt;td&gt;与Result Set消息结构相同&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;[EOF]&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;如果列数大于0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;[Field]&lt;/td&gt;
&lt;td&gt;与Result Set消息结构相同&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;[EOF]&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;其中 PREPARD_OK 的结构如下：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;OK报文，值为0x00&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;预处理语句ID值&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;列数量&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;参数数量&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;填充值（0x00）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;告警计数&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;4.3.10 Parameter 响应报文（Prepared Statement）&lt;/h4&gt;
&lt;p&gt;预处理语句的值与参数正确对应后，服务器会返回 Parameter 报文。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字节&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;类型&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;标志&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;数值精度&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;字段长度&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;类型&lt;/strong&gt;：与 Field 结构中的字段类型相同。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;标志&lt;/strong&gt;：与 Field 结构中的字段标志相同。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;数值精度&lt;/strong&gt;：与 Field 结构中的数值精度相同。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;字段长度&lt;/strong&gt;：与 Field 结构中的字段长度相同。&lt;/p&gt;
&lt;h2&gt;5 参考资料&lt;/h2&gt;
&lt;p&gt;《&lt;a href="http://dev.mysql.com/doc/internals/en/index.html"&gt;MySQL Internals Manual&lt;/a&gt;: &lt;a href="http://dev.mysql.com/doc/internals/en/client-server-protocol.html"&gt;MySQL Client/Server Protocol&lt;/a&gt;》&lt;/p&gt;</summary><category term="Protocol"></category><category term="MySQL"></category><category term="协议分析"></category><category term="数据库"></category></entry></feed>