
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Tony Wang</title>
	<meta name="author" content="Wang Tao">

	
	<meta name="description" content="Sep 6th, 2013 OpenWRT TP-WR703n安装OpenWRT记录 1 安装OpenWRT 1.1 下载并刷新固件 如果以前没刷过OpenWRT，需要升级factory固件，点击这里下载。 如果之前已经安装过了OpenWRT，则直接更新sysupgrade固件即可，点击这里下载 &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Tony Wang" type="application/atom+xml">
	
	<link rel="canonical" href="http://hutaow.github.io/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-17662168-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("hutaow (at) hotmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
</div>
<hgroup>
  <h1><a href="/">Tony Wang</a></h1>
  
    <h2>open source, world shares.</h2>
  
</hgroup>

<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
		<a class="weibo" href="http://www.weibo.com/hutaow" title="Weibo">Weibo</a>
		
		
		<a class="facebook" href="http://www.facebook.com/hutaow" title="Facebook">Facebook</a>
		
		
		
		<a class="twitter" href="http://twitter.com/hutaow" title="Twitter">Twitter</a>
		
		
		
		
		
		<a class="linkedin" href="http://www.linkedin.com/in/hutaow" title="LinkedIn">LinkedIn</a>
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-09-06T23:16:00+08:00" data-updated="true" itemprop="datePublished">Sep 6<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/openwrt/'>OpenWRT</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/09/06/install-openwrt/" itemprop="url">TP-WR703n安装OpenWRT记录</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h3>1 安装OpenWRT</h3>

<h4>1.1 下载并刷新固件</h4>

<p>如果以前没刷过OpenWRT，需要升级factory固件，<a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/openwrt-ar71xx-generic-tl-wr703n-v1-squashfs-factory.bin" title="openwrt-ar71xx-generic-tl-wr703n-v1-squashfs-factory.bin">点击这里下载</a>。</p>

<p>如果之前已经安装过了OpenWRT，则直接更新sysupgrade固件即可，<a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/openwrt-ar71xx-generic-tl-wr703n-v1-squashfs-sysupgrade.bin" title="openwrt-ar71xx-generic-tl-wr703n-v1-squashfs-sysupgrade.bin">点击这里下载</a>。</p>

<p>注意升级的时候要将原配置删除，避免配置文件互相影响，固件刷新完成后，路由器会自动重启。</p>

<h4>1.2 登陆路由器</h4>

<p>OpenWRT主线固件的无线信号是默认关闭的，这个时候需要找跟网线将电脑和路由器连接上，然后将电脑的IP地址设置为静态的&#8221;192.168.1.100&#8221;，然后用Telnet访问&#8221;192.168.1.1&#8221;，正确的情况下，会看到如下界面：
<img class="center" src="/images/articles/201309/install_openwrt_01_first_login.png" title="First Login" ></p>

<h4>1.3 打开无线信号</h4>

<p>编辑&#8221;/etc/config/wireless&#8221;文件，将&#8221;option disabled 1&#8221;这一行注掉，或者直接删除。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>config wifi-device radio0
</span><span class='line'>    option type     mac80211
</span><span class='line'>    option channel  11
</span><span class='line'>    option hwmode   11ng
</span><span class='line'>    option path     'platform/ar933x_wmac'
</span><span class='line'>    option htmode   HT20
</span><span class='line'>    list ht_capab   SHORT-GI-20
</span><span class='line'>    list ht_capab   SHORT-GI-40
</span><span class='line'>    list ht_capab   RX-STBC1
</span><span class='line'>    list ht_capab   DSSS_CCK-40
</span><span class='line'>    # REMOVE THIS LINE TO ENABLE WIFI:
</span><span class='line'>    # option disabled 1
</span><span class='line'>
</span><span class='line'>config wifi-iface
</span><span class='line'>    option device   radio0
</span><span class='line'>    option network  lan
</span><span class='line'>    option mode     ap
</span><span class='line'>    option ssid     OpenWrt
</span><span class='line'>    option encryption none</span></code></pre></td></tr></table></div></figure>


<h4>1.4 外网接入配置</h4>

<p>编辑&#8221;/etc/config/network&#8221;文件，将原&#8221;lan&#8221;区段中的&#8221;ifname&#8221;注掉，新增&#8221;wan&#8221;段，如果是用宽带拨号上网，则配置成下面的样子（其中USERNAME和PASSWORD分别是拨号的用户名和密码）：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>config interface 'loopback'
</span><span class='line'>  option ifname 'lo'
</span><span class='line'>  option proto 'static'
</span><span class='line'>  option ipaddr '127.0.0.1'
</span><span class='line'>  option netmask '255.0.0.0'
</span><span class='line'>
</span><span class='line'>config globals 'globals'
</span><span class='line'>  option ula_prefix 'fd4f:26fb:9d78::/48'
</span><span class='line'>
</span><span class='line'>config interface 'lan'
</span><span class='line'>  # option ifname 'eth0'
</span><span class='line'>  option type 'bridge'
</span><span class='line'>  option proto 'static'
</span><span class='line'>  option ipaddr '192.168.1.1'
</span><span class='line'>  option netmask '255.255.255.0'
</span><span class='line'>  option ip6assign '60'
</span><span class='line'>
</span><span class='line'>config interface 'wan'
</span><span class='line'>  option ifname 'eth0'
</span><span class='line'>  option proto 'pppoe'
</span><span class='line'>  option username 'USERNAME'
</span><span class='line'>  option password 'PASSWORD'</span></code></pre></td></tr></table></div></figure>


<p>如果不需要拨号，直接通过其它路由器连接，则将&#8221;wan&#8221;区段配置成下面的样子：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>config interface 'wan'
</span><span class='line'>  option ifname 'eth0'
</span><span class='line'>  option proto 'dhcp'</span></code></pre></td></tr></table></div></figure>


<h4>1.5 重启路由器，完成OpenWRT的安装</h4>

<p>执行reboot命令重启路由器，将外网线连上，重启后搜索无线信号，就可以看到&#8221;OpenWRT&#8221;的信号了，连接上去，不出意外的话，这个时候电脑已经可以上网了。</p>

<h3>2 将OpenWRT扩展至U盘</h3>

<h4>2.1 安装基本软件</h4>

<p>再次用Telnet访问&#8221;192.168.1.1&#8221;，执行下面的命令，将挂载U盘相关的基本软件安装上。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>opkg update
</span><span class='line'>opkg install block-mount kmod-fs-ext4 kmod-usb-ohci kmod-usb-storage e2fsprogs</span></code></pre></td></tr></table></div></figure>


<h4>2.2 准备挂载U盘</h4>

<p>将U盘插上，执行&#8221;block info&#8221;命令，看下U盘是否已被识别，如下图，其中中sda1、sda2、sda5为U盘分区：
<img class="center" src="/images/articles/201309/install_openwrt_02_block_info.png" title="Block Info" ></p>

<h4>2.3 拷贝系统文件</h4>

<p>执行如下命令，将路由器ROM中的系统文件全部拷贝到U盘中：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mount /dev/sda1 /mnt 
</span><span class='line'>mkdir /tmp/vroot 
</span><span class='line'>mount --bind / /tmp/vroot 
</span><span class='line'>cp -a /tmp/vroot/* /mnt 
</span><span class='line'>sync 
</span><span class='line'>umount /tmp/vroot</span></code></pre></td></tr></table></div></figure>


<h4>2.4 设置交换空间（可选）</h4>

<p>U盘在分区时可以预留一个交换分区，防止路由器内存不足，这里预留的交换分区是sda5，执行下面的命令：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>swapon /dev/sda5</span></code></pre></td></tr></table></div></figure>


<h4>2.5 保存挂载信息</h4>

<p>将当前挂载状态写入fstab文件中：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>block detect &gt; /etc/config/fstab</span></code></pre></td></tr></table></div></figure>


<p>然后修改&#8221;/etc/config/fstab&#8221;文件，将sda1的挂载点设置为&#8221;/&ldquo;，并将&#8221;option enabled&#8221;置1，配置类似下面的样子：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>config global
</span><span class='line'>  option anon_swap '0'
</span><span class='line'>  option anon_mount '0'
</span><span class='line'>  option auto_swap '1'
</span><span class='line'>  option auto_mount '1'
</span><span class='line'>  option delay_root '5'
</span><span class='line'>  option check_fs '0'
</span><span class='line'>
</span><span class='line'>config mount
</span><span class='line'>  option target '/'
</span><span class='line'>  option uuid '413b964c-9c9c-4af4-8966-daf04ee53414'
</span><span class='line'>  option enabled '1'
</span><span class='line'>  option fstype 'ext4'
</span><span class='line'>
</span><span class='line'>config mount
</span><span class='line'>  option target '/home'
</span><span class='line'>  option uuid 'e7052ed0-b883-4375-9f31-5648ea8f2948'
</span><span class='line'>  option enabled '1'
</span><span class='line'>  option fstype 'ext4'
</span><span class='line'>
</span><span class='line'>config swap
</span><span class='line'>  option uuid '58713d02-e9de-4c23-a56b-a5ea3d3dfcf0'
</span><span class='line'>  option enabled '1'</span></code></pre></td></tr></table></div></figure>


<p>如果U盘只有一个分区，会只看到一个sda1(&ldquo;/&rdquo;)，其它诸如sda2(&ldquo;/home&rdquo;)、sda5(&ldquo;swap&rdquo;)需要额外分区才能看到。</p>

<h4>2.6 重启路由器，完成OpenWRT的扩展</h4>

<p>重启路由器，再次&#8221;df -h&#8221;一下，可以看到路由器的空间已经扩展成功了。
<img class="center" src="/images/articles/201309/install_openwrt_03_df.png" title="DF Info" ></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2008-03-20T15:08:00+08:00" data-updated="true" itemprop="datePublished">Mar 20<span>th</span>, 2008</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/programming/'>Programming</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2008/03/20/compilation-failed-due-to-character-encoding/" itemprop="url">因字符编码导致的编译不同过</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>从网上下了QR标准的二维码库，打算直接调用里面的类来实现。在Fedora下Java编译通过，只是提示了一下使用了过时的方法。但我把代码复制到Windows里时，却编译不同过，出现了近1k个错误，代码完全一样，只是操作系统不同就会出问题？</p>

<p>回想在Windows里用UltraEdit打开时，提示文件不是&#8221;DOS Format&#8221;，会不会和文字编码有关？Linux用的是UTF-8的编码，而Windows用的是GBK的编码，难道字符编码必须要和本地相同才能编译通过么？试一下，于是把代码用UltraEdit转换成了GBK编码，再次编译，终于正常通过。</p>

<p>看来有时编译不通过不一定是语句问题，连文件的编码也有可能出问题，如果在不同系统中出现类似上面一个正常一个错误的情况，可以考虑看是不是因为文件的编码和系统默认的编码有差异而引起的。</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2008-02-17T21:28:00+08:00" data-updated="true" itemprop="datePublished">Feb 17<span>th</span>, 2008</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/linux/'>Linux</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2008/02/17/disable-automatically-mount-partitions-under-fedora/" itemprop="url">Fedora禁止自动挂载分区的方法</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>Fedora在启动时会自动把系统中的其它分区挂载，为了对自动挂载的分区进行一定的限制，就要改变相应的策略，这一策略存放在&#8221;/usr/share/hal/fdi/policy/10osvendor/20-storage-methods.fdi&#8221;文件中。</p>

<p>找到以下提示行</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- Here follow volumes we specifically want to ignore - it is the --&gt;
</span><span class='line'>&lt;!-- responsibility of software higher in the stack (e.g. gnome-vfs) --&gt;
</span><span class='line'>&lt;!-- amd mount programs (e.g. Mount() on HAL) to respect volume.ignore --&gt;
</span><span class='line'>&lt;merge key="volume.ignore" type="bool"&gt;false&lt;/merge&gt;</span></code></pre></td></tr></table></div></figure>


<p>按照说明在提示之后添加对磁盘挂载的策略即可，比如我自己的硬盘就是</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;match key="volume.fstype" string="vfat"&gt;
</span><span class='line'>  &lt;match key="volume.label" string="DATA"&gt;
</span><span class='line'>    &lt;merge key="volume.ignore" type="bool"&gt;true&lt;/merge&gt;
</span><span class='line'>  &lt;/match&gt;
</span><span class='line'>  &lt;match key="volume.label" string="MULTI"&gt;
</span><span class='line'>    &lt;merge key="volume.ignore" type="bool"&gt;true&lt;/merge&gt;
</span><span class='line'>  &lt;/match&gt;
</span><span class='line'>  &lt;match key="volume.label" string="BACKUP"&gt;
</span><span class='line'>    &lt;merge key="volume.ignore" type="bool"&gt;true&lt;/merge&gt;
</span><span class='line'>  &lt;/match&gt;
</span><span class='line'>&lt;/match&gt;</span></code></pre></td></tr></table></div></figure>


<p>其中&#8221;volume.fstype&#8221;后面的值就是匹配的文件系统，&#8221;volume.label&#8221;后面的值是匹配的卷标，&#8221;volume.ignore&#8221;中的参数是&#8221;true&#8221;，意思是忽略被匹配的分区。</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2008-02-15T20:16:00+08:00" data-updated="true" itemprop="datePublished">Feb 15<span>th</span>, 2008</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/linux/'>Linux</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2008/02/15/slove-the-problem-on-install-ntfs-3g/" itemprop="url">解决安装ntfs-3g时遇到的问题</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>今天安装了CentOS，结果发现好多软件源里都没有，看来又要手动安装了，为了挂载ntfs分区，跑去<a href="http://www.ntfs-3g.org">http://www.ntfs-3g.org</a>下载ntfs-3g，安装好后，试图执行&#8221;mount -t ntfs-3g /dev/hdc5 /media/wdata&#8221;，结果提示：</p>

<pre><code>FATAL: Module fuse not found.
fuse: device not found, try 'modprobe fuse' first
</code></pre>

<p>冷不丁的冒出这么个错误提示，有点措手不及的感觉，于是按照提示执行&#8221;modprobe fuse&#8221;，结果又出来：</p>

<pre><code>FATAL: Module fuse not found.
</code></pre>

<p>没有fuse模块？用Google搜到了<a href="http://fuse.sourceforge.net">http://fuse.sourceforge.net</a>，看上面说明的意思是说fuse(Filesystem in Userspace)是个库，提供了API供用户开发文件系统，看样子通过它开发文件系统又会方便不少，最后只要连接到fuse库上就可以了。呵呵，不管怎么说先下载了安装再说，这些以后有时间再慢慢研究吧。下载后解压，执行下面的命令编译安装fuse：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./configure
</span><span class='line'>make
</span><span class='line'>make install</span></code></pre></td></tr></table></div></figure>


<p>装好后再次执行mount命令，完成！</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2008-02-13T15:51:00+08:00" data-updated="true" itemprop="datePublished">Feb 13<span>th</span>, 2008</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/android/'>Android</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2008/02/13/compile-android-project-in-command-line/" itemprop="url">Android命令行下的编译和运行</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>想学到东西还是要从命令行开始，真正学到之后再考虑用IDE。下面总结一下在命令行下android工程的创建、编译、运行和调试的方法。</p>

<h3>1 工程的创建</h3>

<p>在要存放工程的目录下用执行&#8221;activityCreator.py &mdash;out hutaow edu.bupt.hutaow.example&#8221; </p>

<p>说明如下：</p>

<ul>
<li>activityCreator.py，创建工程的脚本文件，linux里使用&#8221;activityCreator.py&#8221;，如果是windows，则应当换成&#8221;activityCreator.bat&#8221;</li>
<li>&mdash;out hutaow，其中hutaow是生成工程的输出目录，执行android工程的所有文件都会放在这个目录里</li>
<li>edu.bupt.hutaow.example，这个是包的名称以及类的名称，其中最后一个字段是生成的类的名称，edu.bupt.hutaow是example类所在的包</li>
</ul>


<p>命令执行后会在hutaow目录下生成工程的所有文件。</p>

<p>执行后终端输出如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package: edu.bupt.hutaow
</span><span class='line'>out_dir: hutaow
</span><span class='line'>activity_name: example
</span><span class='line'>Created directory hutaow/src/edu/bupt/hutaow
</span><span class='line'>Added file hutaow/src/edu/bupt/hutaow/example.java
</span><span class='line'>Created directory hutaow/bin
</span><span class='line'>Created directory hutaow/res/values
</span><span class='line'>Added file hutaow/res/values/strings.xml
</span><span class='line'>Created directory hutaow/res/layout
</span><span class='line'>Added file hutaow/res/layout/main.xml
</span><span class='line'>Added file hutaow/AndroidManifest.xml
</span><span class='line'>Added file hutaow/build.xml</span></code></pre></td></tr></table></div></figure>


<h3>2 工程的编译</h3>

<p>这里编译需要用到Ant，Ant是Apache出的用于编译Java工程文件的工具，Android是基于Java设计的，所以这里要用到它，Ant可以在<a href="http://ant.apache.org">http://ant.apache.org</a>下载的到，具体安装过程和Java、Android差不多，都是解压出来后设置环境变量，可以参考Linux中设置Java环境变量。</p>

<p>使用Ant编译直接在工程目录下执行简单的一条&#8221;ant&#8221;即可，不用任何参数，Ant会根据build.xml文件中的描述自动进行相关的语法检查、依赖分析等等一些工作，最终将编译好的文件输出在工程的bin目录下。</p>

<p>执行后终端输出如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Buildfile: build.xml
</span><span class='line'>
</span><span class='line'>dirs:
</span><span class='line'>    [mkdir] Created dir: /home/wangtao/Documents/android/hutaow/bin/classes
</span><span class='line'>
</span><span class='line'>resource-src:
</span><span class='line'>     [echo] Generating R.java...
</span><span class='line'>
</span><span class='line'>aidl:
</span><span class='line'>
</span><span class='line'>compile:
</span><span class='line'>    [javac] Compiling 2 source files to /home/wangtao/Documents/android/hutaow/bin/classes
</span><span class='line'>
</span><span class='line'>dex:
</span><span class='line'>
</span><span class='line'>package-res:
</span><span class='line'>
</span><span class='line'>package-res-no-assets:
</span><span class='line'>     [echo] Packaging resources...
</span><span class='line'>
</span><span class='line'>package-dex:
</span><span class='line'>     [echo] Packaging dex...
</span><span class='line'>
</span><span class='line'>package:
</span><span class='line'>
</span><span class='line'>BUILD SUCCESSFUL
</span><span class='line'>Total time: 6 seconds</span></code></pre></td></tr></table></div></figure>


<h3>3 程序的运行及调试</h3>

<p>这里要用到的工具是android的调试工具adb，由它来完成程序的安装工作。首先在命令行输入&#8221;emulator&#8221;启动android模拟器。</p>

<p>然后等模拟器完全启动好后，执行&#8221;adb install bin/example.apk&#8221;，即将example.apk安装到模拟器中。</p>

<p>最终在模拟器的&#8221;Applications&#8221;分类中找到&#8221;example&#8221;执行程序。</p>

<p>执行后终端输出如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>* daemon not running. starting it now *
</span><span class='line'>33 KB/s (4170 bytes in 0.120s)</span></code></pre></td></tr></table></div></figure>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2008-02-11T18:28:00+08:00" data-updated="true" itemprop="datePublished">Feb 11<span>th</span>, 2008</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/linux/'>Linux</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2008/02/11/change-the-spped-of-network-adapter-under-linux/" itemprop="url">Linux中改变网卡的速度</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>今天又用到家里的那根20几米的超长网线了，因为太长了，之前windows里用它联网的时候要把网卡速度降到10Mbps才能用。如果自动配置的话会默认用100Mbps的速度连接，但这样的话就会时断时连很不稳定。</p>

<p>我在Linux里试图在Network里直接配置速度，但没有找到，上网google发现需要手动修改，用到的工具是mii-tool。</p>

<p>用管理员权限执行如下命令</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mii-tool -A 10baseT-FD eth0</span></code></pre></td></tr></table></div></figure>


<p>eth0是网卡的名称，&#8221;10baseT-FD&#8221;是网卡的工作模式，如果要改回100Mbps的话这里填&#8221;100baseTx-FD&#8221;；</p>

<p>FD指的是Full Duplex全双工，也可以是HD即Half Duplex半双工。</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2008-02-02T21:44:00+08:00" data-updated="true" itemprop="datePublished">Feb 2<span>nd</span>, 2008</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/linux/'>Linux</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2008/02/02/slove-mplayer-chinese-subtitles-problems/" itemprop="url">解决MPlayer中文字幕显示问题</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>MPlayer在播放电影时，中文字幕往往不能正确显示，自己简单分析了一下，之所以中文显示出乱码是由于字符的编码选择不正确造成的。</p>

<p>在MPlayer的设置里有两个地方要对字符编码进行设置，一个是对显示字幕的编码进行设置，另一个是对字体文件的编码设置。</p>

<p>对于字幕的编码，就是要显示中文、英文、法文还是其它文字；而对于字体的编码，则是需要根据提供的字体文件严格选择对应的编码。明白了以上两点，再进行设置就不难了。</p>

<p>具体的设置过程如下：</p>

<ol>
<li><p>首先选择字幕编码，在MPlayer的设置中选择&#8221;Subtitle &amp; OSD&#8221;选项卡，在&#8221;Encoding&#8221;选单中选择&#8221;Simplified Chinese charset (CP936)&ldquo;。</p></li>
<li><p>接下来是字体编码，先要选择一个中文字体，&#8221;Font&#8221;选项卡中，在&#8221;Font&#8221;一栏选择一个中文字体(个人建议将自己的字体放在~/.fonts目录下，然后再到这个目录中选择相应的字体)。字体选择好后，在&#8221;Encoding&#8221;选单中选择&#8221;Unicode&#8221;，因为unicode是国际通用的字符编码标准，一般的字体编码都是unicode，所以此处要选择&#8221;Unicode&#8221;而不是&#8221;CP936&#8221;。</p></li>
<li><p>确定保存后重新播放中文字幕就可以正常显示了。</p></li>
</ol>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2008-02-02T08:45:00+08:00" data-updated="true" itemprop="datePublished">Feb 2<span>nd</span>, 2008</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/linux/'>Linux</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2008/02/02/rhythmbox-play-mp3-and-wma-format-decoder-required/" itemprop="url">Rhythmbox播放MP3和WMA所需要的解码器</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<ul>
<li>如果想支持mp3，需要gstreamer-plugins-bad和gstreamer-plugins-ugly</li>
<li>如果想支持wma，需要gstreamer-ffmpeg</li>
</ul>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2008-01-30T11:50:00+08:00" data-updated="true" itemprop="datePublished">Jan 30<span>th</span>, 2008</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/android/'>Android</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2008/01/30/android-calculator/" itemprop="url">用Android做了一个计算器</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>这两天一直在看xml，昨天简单的做了一个计算器，算是实地练习一下，熟悉一下Android的开发过程，不过有些小问题还没有顾及，还有就是界面可能稍显难看了一些。</p>

<p>运行时的截图：
<img class="center" src="/images/articles/200801/android_calculator.png" title="Android Calculator" ></p>

<p>源代码地址：<a href="https://github.com/hutaow/AndroidCalculator">点击这里</a></p>

<p>PS: 今天整理的时候发现一个问题，这个程序是我原来用Android SDK的m3版本生成编译的，现在SDK的最新版本是m5，结果在m5里竟然编译不通过。解决方法是可以重新创建一个项目，直接将源代码部分复制粘贴过去就可以了，新的项目仍然可以编译运行，我想应该是build.xml那个文件里的问题，版本、结构上google可能改了一些，不过不碍大事。</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2008-01-28T20:13:00+08:00" data-updated="true" itemprop="datePublished">Jan 28<span>th</span>, 2008</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/android/'>Android</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2008/01/28/understanding-on-the-android-layout/" itemprop="url">对Android布局的理解</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>前一段时间一直在考试，现在放假了，有时间好好的看了一下Android的布局。</p>

<p>之前对于XML的布局方法一直看着不爽，感觉很乱的样子，但时间长了我渐渐发现，这种程序代码与界面布局完全分开的方法非常顺手，该布局的地方都到main.xml里去写，甚至界面中显示的字符串都可以集中到string.xml文件中，而主程序的&#8221;.java&#8221;文件中则完全用于编写代码，思路非常清晰。</p>

<h3>1 首先按照程序的目录结构大致分析</h3>

<pre><code>res/layout/   这个目录存放的就是布局用的xml文件，一般默认为main.xml
res/values/   这个目录存放的是一堆常量的xml文件
res/drawable/ 存放的是一些图片什么的，当然图标也在这里
</code></pre>

<h3>2 下面主要对layout下的xml文件做个介绍，顺便也把布局的方法总结一下</h3>

<h4>2.1 文件的开头</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></code></pre></td></tr></table></div></figure>


<p>这是在说明xml版本及字符编码</p>

<h4>2.2 布局框架</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>  android:layout_width="wrap_content"
</span><span class='line'>  android:layout_height="wrap_content"&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>


<p>其中开头的&#8221;LinearLayout&#8221;是布局的方式，可以有很多种，最常用的应该就是Linear了，其他的布局方法等下在后面总结。</p>

<p>接着android:layout_width(height)=&ldquo;wrap_content&#8221;是在设置这部分布局的宽高，也可以是绝对值，当然设置为绝对值时要标上单位。</p>

<h4>2.3 添加控件</h4>

<p>在&#8221;&lt;LinearLayout>&ldquo;和&rdquo;&lt;/LinearLayout>&ldquo;之间就可以添加控件了，比如要添加一个名字为btn的Button控件，并且Button上显示的文字是&#8221;Test!&#8221;，可以这样写：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;Button id="@+id/btn" 
</span><span class='line'>  android:text="Test!"
</span><span class='line'>  android:layout_width="wrap_content"
</span><span class='line'>  android:layout_height="wrap_content"
</span><span class='line'>/&gt;</span></code></pre></td></tr></table></div></figure>


<p>开头id后面的就是控件名称，在用于添加事件Listener时会用到，而下几行的android:xxx就是设置控件的属性了，这些属性在Android的文档中都有，不需要特别去记，一般现查就可以了。</p>

<p><strong><em>有一点要说明的是，布局方法可以嵌套，有点像java中的Container，可以非常方便的把界面“堆”出来。</em></strong></p>

<p>布局方式的简单说明：
查了Android文档发现布局确实很多，只列出两个我自己认为较常用的：</p>

<ul>
<li>LinearLayout线性的布局方式，要么上下，要么左右的添加控件，很常用</li>
<li>GridView中文翻译过来是网格布局，控件按照顺序依次填到每个格子里就好了，出来的界面会很整齐</li>
</ul>


<p>其他的布局方式可以在需要时查文档，这里不再列出。</p>

		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2008 - Wang Tao -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			

<script type="text/javascript">
      var disqus_shortname = 'hutaow';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>







		</div>
	</div>
</body>
</html>
