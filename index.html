
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Tony Wang</title>
	<meta name="author" content="Wang Tao">

	
	<meta name="description" content="Sep 6th, 2013 OpenWRT TP-WR703n安装OpenWRT记录 1 安装OpenWRT 1.1 下载并刷新固件 如果以前没刷过OpenWRT，需要升级factory固件，点击这里下载。 如果之前已经安装过了OpenWRT，则直接更新sysupgrade固件即可，点击这里下载 &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Tony Wang" type="application/atom+xml">
	
	<link rel="canonical" href="http://hutaow.github.io/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-17662168-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("hutaow (at) hotmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
</div>
<hgroup>
  <h1><a href="/">Tony Wang</a></h1>
  
    <h2>open source, world shares.</h2>
  
</hgroup>

<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
		<a class="weibo" href="http://www.weibo.com/hutaow" title="Weibo">Weibo</a>
		
		
		<a class="facebook" href="http://www.facebook.com/hutaow" title="Facebook">Facebook</a>
		
		
		
		<a class="twitter" href="http://twitter.com/hutaow" title="Twitter">Twitter</a>
		
		
		
		
		
		<a class="linkedin" href="http://www.linkedin.com/in/hutaow" title="LinkedIn">LinkedIn</a>
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-09-06T23:16:00+08:00" data-updated="true" itemprop="datePublished">Sep 6<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/openwrt/'>OpenWRT</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/09/06/install-openwrt/" itemprop="url">TP-WR703n安装OpenWRT记录</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h3>1 安装OpenWRT</h3>

<h4>1.1 下载并刷新固件</h4>

<p>如果以前没刷过OpenWRT，需要升级factory固件，<a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/openwrt-ar71xx-generic-tl-wr703n-v1-squashfs-factory.bin" title="openwrt-ar71xx-generic-tl-wr703n-v1-squashfs-factory.bin">点击这里下载</a>。</p>

<p>如果之前已经安装过了OpenWRT，则直接更新sysupgrade固件即可，<a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/openwrt-ar71xx-generic-tl-wr703n-v1-squashfs-sysupgrade.bin" title="openwrt-ar71xx-generic-tl-wr703n-v1-squashfs-sysupgrade.bin">点击这里下载</a>。</p>

<p>注意升级的时候要将原配置删除，避免配置文件互相影响，固件刷新完成后，路由器会自动重启。</p>

<h4>1.2 登陆路由器</h4>

<p>OpenWRT主线固件的无线信号是默认关闭的，这个时候需要找跟网线将电脑和路由器连接上，然后将电脑的IP地址设置为静态的&#8221;192.168.1.100&#8221;，然后用Telnet访问&#8221;192.168.1.1&#8221;，正确的情况下，会看到如下界面：
<img class="center" src="/images/articles/201309/install_openwrt_01_first_login.png" title="First Login" ></p>

<h4>1.3 打开无线信号</h4>

<p>编辑&#8221;/etc/config/wireless&#8221;文件，将&#8221;option disabled 1&#8221;这一行注掉，或者直接删除。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>config wifi-device radio0
</span><span class='line'>    option type     mac80211
</span><span class='line'>    option channel  11
</span><span class='line'>    option hwmode   11ng
</span><span class='line'>    option path     'platform/ar933x_wmac'
</span><span class='line'>    option htmode   HT20
</span><span class='line'>    list ht_capab   SHORT-GI-20
</span><span class='line'>    list ht_capab   SHORT-GI-40
</span><span class='line'>    list ht_capab   RX-STBC1
</span><span class='line'>    list ht_capab   DSSS_CCK-40
</span><span class='line'>    # REMOVE THIS LINE TO ENABLE WIFI:
</span><span class='line'>    # option disabled 1
</span><span class='line'>
</span><span class='line'>config wifi-iface
</span><span class='line'>    option device   radio0
</span><span class='line'>    option network  lan
</span><span class='line'>    option mode     ap
</span><span class='line'>    option ssid     OpenWrt
</span><span class='line'>    option encryption none</span></code></pre></td></tr></table></div></figure>


<h4>1.4 外网接入配置</h4>

<p>编辑&#8221;/etc/config/network&#8221;文件，将原&#8221;lan&#8221;区段中的&#8221;ifname&#8221;注掉，新增&#8221;wan&#8221;段，如果是用宽带拨号上网，则配置成下面的样子（其中USERNAME和PASSWORD分别是拨号的用户名和密码）：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>config interface 'loopback'
</span><span class='line'>  option ifname 'lo'
</span><span class='line'>  option proto 'static'
</span><span class='line'>  option ipaddr '127.0.0.1'
</span><span class='line'>  option netmask '255.0.0.0'
</span><span class='line'>
</span><span class='line'>config globals 'globals'
</span><span class='line'>  option ula_prefix 'fd4f:26fb:9d78::/48'
</span><span class='line'>
</span><span class='line'>config interface 'lan'
</span><span class='line'>  # option ifname 'eth0'
</span><span class='line'>  option type 'bridge'
</span><span class='line'>  option proto 'static'
</span><span class='line'>  option ipaddr '192.168.1.1'
</span><span class='line'>  option netmask '255.255.255.0'
</span><span class='line'>  option ip6assign '60'
</span><span class='line'>
</span><span class='line'>config interface 'wan'
</span><span class='line'>  option ifname 'eth0'
</span><span class='line'>  option proto 'pppoe'
</span><span class='line'>  option username 'USERNAME'
</span><span class='line'>  option password 'PASSWORD'</span></code></pre></td></tr></table></div></figure>


<p>如果不需要拨号，直接通过其它路由器连接，则将&#8221;wan&#8221;区段配置成下面的样子：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>config interface 'wan'
</span><span class='line'>  option ifname 'eth0'
</span><span class='line'>  option proto 'dhcp'</span></code></pre></td></tr></table></div></figure>


<h4>1.5 重启路由器，完成OpenWRT的安装</h4>

<p>执行reboot命令重启路由器，将外网线连上，重启后搜索无线信号，就可以看到&#8221;OpenWRT&#8221;的信号了，连接上去，不出意外的话，这个时候电脑已经可以上网了。</p>

<h3>2 将OpenWRT扩展至U盘</h3>

<h4>2.1 安装基本软件</h4>

<p>再次用Telnet访问&#8221;192.168.1.1&#8221;，执行下面的命令，将挂载U盘相关的基本软件安装上。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>opkg update
</span><span class='line'>opkg install block-mount kmod-fs-ext4 kmod-usb-ohci kmod-usb-storage e2fsprogs</span></code></pre></td></tr></table></div></figure>


<h4>2.2 准备挂载U盘</h4>

<p>将U盘插上，执行&#8221;block info&#8221;命令，看下U盘是否已被识别，如下图，其中中sda1、sda2、sda5为U盘分区：
<img class="center" src="/images/articles/201309/install_openwrt_02_block_info.png" title="Block Info" ></p>

<h4>2.3 拷贝系统文件</h4>

<p>执行如下命令，将路由器ROM中的系统文件全部拷贝到U盘中：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mount /dev/sda1 /mnt 
</span><span class='line'>mkdir /tmp/vroot 
</span><span class='line'>mount --bind / /tmp/vroot 
</span><span class='line'>cp -a /tmp/vroot/* /mnt 
</span><span class='line'>sync 
</span><span class='line'>umount /tmp/vroot</span></code></pre></td></tr></table></div></figure>


<h4>2.4 设置交换空间（可选）</h4>

<p>U盘在分区时可以预留一个交换分区，防止路由器内存不足，这里预留的交换分区是sda5，执行下面的命令：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>swapon /dev/sda5</span></code></pre></td></tr></table></div></figure>


<h4>2.5 保存挂载信息</h4>

<p>将当前挂载状态写入fstab文件中：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>block detect &gt; /etc/config/fstab</span></code></pre></td></tr></table></div></figure>


<p>然后修改&#8221;/etc/config/fstab&#8221;文件，将sda1的挂载点设置为&#8221;/&ldquo;，并将&#8221;option enabled&#8221;置1，配置类似下面的样子：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>config global
</span><span class='line'>  option anon_swap '0'
</span><span class='line'>  option anon_mount '0'
</span><span class='line'>  option auto_swap '1'
</span><span class='line'>  option auto_mount '1'
</span><span class='line'>  option delay_root '5'
</span><span class='line'>  option check_fs '0'
</span><span class='line'>
</span><span class='line'>config mount
</span><span class='line'>  option target '/'
</span><span class='line'>  option uuid '413b964c-9c9c-4af4-8966-daf04ee53414'
</span><span class='line'>  option enabled '1'
</span><span class='line'>  option fstype 'ext4'
</span><span class='line'>
</span><span class='line'>config mount
</span><span class='line'>  option target '/home'
</span><span class='line'>  option uuid 'e7052ed0-b883-4375-9f31-5648ea8f2948'
</span><span class='line'>  option enabled '1'
</span><span class='line'>  option fstype 'ext4'
</span><span class='line'>
</span><span class='line'>config swap
</span><span class='line'>  option uuid '58713d02-e9de-4c23-a56b-a5ea3d3dfcf0'
</span><span class='line'>  option enabled '1'</span></code></pre></td></tr></table></div></figure>


<p>如果U盘只有一个分区，会只看到一个sda1(&ldquo;/&rdquo;)，其它诸如sda2(&ldquo;/home&rdquo;)、sda5(&ldquo;swap&rdquo;)需要额外分区才能看到。</p>

<h4>2.6 重启路由器，完成OpenWRT的扩展</h4>

<p>重启路由器，再次&#8221;df -h&#8221;一下，可以看到路由器的空间已经扩展成功了。
<img class="center" src="/images/articles/201309/install_openwrt_03_df.png" title="DF Info" ></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2010-05-14T22:13:00+08:00" data-updated="true" itemprop="datePublished">May 14<span>th</span>, 2010</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/network/'>Network</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2010/05/14/config-cisco-catalyst-3560-switch-port-mirroring/" itemprop="url">配置 Cisco Catalyst 3560 交换机端口镜像</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>假设要将19和27号端口的数据镜像到2号端口，按如下操作进行：</p>

<p>1) 通过串口登陆到交换机，其中参数设置为：速率9600bps，8位数据位，1位停止位，无奇偶校验，无流量控制。</p>

<p>2) 交换机上电自检然后登入后出现命令提示符：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Switch&gt;</span></code></pre></td></tr></table></div></figure>


<p>3) 依次进入特权模式和全局模式，输入如下命令：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Switch&gt;enable
</span><span class='line'>Password:
</span><span class='line'>Switch#configure terminal
</span><span class='line'>Enter configuration commands, one per line.  End with CNTL/Z.
</span><span class='line'>Switch(config)#</span></code></pre></td></tr></table></div></figure>


<p>4) 在新session中，将端口19和27设置为被监听端口(source)，2号端口设置为监听端口(destination)，命令如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Switch(config)#monitor session 1 source interface Fa0/19
</span><span class='line'>Switch(config)#monitor session 1 source interface Fa0/27
</span><span class='line'>Switch(config)#monitor session 1 destination interface Fa0/2
</span><span class='line'>Switch(config)#end
</span><span class='line'>Switch#
</span><span class='line'>03:30:52: %SYS-5-CONFIG_I: Configured from console by console</span></code></pre></td></tr></table></div></figure>


<p>5) 断开连接，完成。</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2010-04-27T12:43:00+08:00" data-updated="true" itemprop="datePublished">Apr 27<span>th</span>, 2010</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/programming/'>Programming</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2010/04/27/get-xml-node-value-with-c-sharp-language/" itemprop="url">C#获取XML文件指定节点的数据</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>实例说明会更清楚些，假设有如下XML文件：</p>

<figure class='code'><figcaption><span>message_hutaow.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;Message</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;Head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;Date&gt;</span>20080502<span class="nt">&lt;/Date&gt;</span>
</span><span class='line'>    <span class="nt">&lt;Source&gt;</span>
</span><span class='line'>      <span class="nt">&lt;Address&gt;</span>192.168.0.1<span class="nt">&lt;/Address&gt;</span>
</span><span class='line'>      <span class="nt">&lt;Name&gt;</span>hutaow<span class="nt">&lt;/Name&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/Source&gt;</span>
</span><span class='line'>    <span class="nt">&lt;Target&gt;</span>
</span><span class='line'>      <span class="nt">&lt;Address&gt;</span>192.168.0.19<span class="nt">&lt;/Address&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/Target&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/Head&gt;</span>
</span><span class='line'><span class="nt">&lt;/Message&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>现在要读取消息源IP地址(192.168.0.1)和目的IP地址(192.168.0.19)。</p>

<p>根据上面XML文件的结构，查找路径为&#8221;/Message/Head/Source/Address&#8221;和&#8221;/Message/Head/Target/Address&#8221;，需要用到XPath的寻径方式，代码如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="c1">// 需要引用System.Xml库</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Xml</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 省略中间无关代码</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 加载XML文件</span>
</span><span class='line'><span class="n">XmlDocument</span> <span class="n">xmlDoc</span> <span class="p">=</span> <span class="k">new</span> <span class="n">XmlDocument</span><span class="p">();</span>
</span><span class='line'><span class="n">xmlDoc</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="s">&quot;message_hutaow.xml&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 使用XPath方式寻找源IP地址节点并输出</span>
</span><span class='line'><span class="n">xmlNode</span> <span class="p">=</span> <span class="n">xmlDoc</span><span class="p">.</span><span class="n">SelectSingleNode</span><span class="p">(</span><span class="s">&quot;/Message/Head/Source/Address&quot;</span><span class="p">);</span>
</span><span class='line'><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Source Address: {0}&quot;</span><span class="p">,</span><span class="n">xmlNode</span><span class="p">.</span><span class="n">InnerText</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 使用XPath方式寻找目的IP地址节点并输出</span>
</span><span class='line'><span class="n">xmlNode</span> <span class="p">=</span> <span class="n">xmlDoc</span><span class="p">.</span><span class="n">SelectSingleNode</span><span class="p">(</span><span class="s">&quot;/Message/Head/Target/Address&quot;</span><span class="p">);</span>
</span><span class='line'><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Target Address: {0}&quot;</span><span class="p">,</span><span class="n">xmlNode</span><span class="p">.</span><span class="n">InnerText</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>控制台输出</p>

<pre><code>Source Address: 192.168.0.1
Target Address: 192.168.0.19
</code></pre>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2010-04-21T10:48:00+08:00" data-updated="true" itemprop="datePublished">Apr 21<span>st</span>, 2010</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/security/'>Security</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2010/04/21/install-idmef-plugin-for-snort/" itemprop="url">Snort安装IDMEF插件</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>Snort作为一款开源的入侵检测系统，可以与其它各种网络设备连接协同工作，其中IDMEF插件可以实现设备之间报警信息的共享，在安装该插件时，需要注意以下几个问题：</p>

<ol>
<li><p>IDMEF插件依赖于<a href="http://sourceforge.net/projects/libidmef">libidmef</a>、<a href="http://xmlsoft.org">libxml2</a>及<a href="http://www.ntp.org">libntp</a>库，所以在安装Snort之前，需要首先安装这三个库。</p></li>
<li><p>配置Snort时，需要加上&#8221;&mdash;enable-idmef&#8221;参数，如下所示：</p></li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./configure --enable-idmef
</span><span class='line'>make
</span><span class='line'>make install</span></code></pre></td></tr></table></div></figure>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2010-04-17T21:25:00+08:00" data-updated="true" itemprop="datePublished">Apr 17<span>th</span>, 2010</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/security/'>Security</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2010/04/17/intrusion-dedection-and-response-system-for-information-sharing/" itemprop="url">入侵检测与响应系统的信息共享</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h3>引言</h3>

<p>入侵检测系统(IDS)与其它系统(如防火墙)交互过程中，需要遵循一定的规范和协议，然而生产IDS的各个厂家的报警日志及数据格式均有所区别，所以在不同设备之间交互会遇到很多麻烦。早先知道的是CheckPoint提出的OPSec协议和天融信提出的TOPSec协议，凡是遵循这两个协议的网络安全设备均可与相应的IDS进行交互，协同防护网络安全。在2007年，IETF针对这种交互情况形成了四份相关文档，分为三个部分，分别是隧道轮廓(RFC3620 &ndash; The TUNNEL Profile)、入侵检测消息交换格式和要求(RFC4765 &ndash; IDMEF, RFC4766 &ndash; IDMER)、入侵检测交换协议(RFC4767 &ndash; IDXP)。</p>

<p>值得注意的是，IETF规定IDS对其它设备交互的方式采用XML格式存储和传输，和SOAP似乎有些相似，XML跨平台跨语言结构清晰等优点使它的应用范围越来越广，几乎达到了无处不用XML的程度。
　</p>

<h3>1 入侵检测消息交互过程</h3>

<h4>1.1 建立连接</h4>

<p>使用IDXP传输数据的入侵检测实体被称为IDXP对等体。对等体只能成对出现，这些对等体通过BEEP会话中的一个或多个BEEP信道进行数据传输。对等体可能是管理器或分析器。</p>

<p>在分析器和管理器之间很可能是多对多的关系。即一个分析器可以和多个管理器通信，同样，一个管理器也可以和多个分析器通信；在不同的管理器之间也可以是多对多的关系。所以，一个管理器可以通过多个中间管理器接收大量的来自分析器的报警信息。但是，各个分析器之间禁止建立IDXP连接，避免重复报警情况的发生。</p>

<p><strong>对等体&#8221;Alice&#8221;和&#8221;Bob&#8221;建立IDXP交换的过程</strong></p>

<p>IDXP对等体之间通过打开一个BEEP信道进行通信。在打开BEEP信道之前，需要首先建立BEEP会话，然后就安全特性等问题进行协商。BEEP安全轮廓协商成功后，再经互相确认应答，然后开始IDXP交换。</p>

<pre><code>Alice                                               Bob
  ------------------- 建立连接(1) --------------------&gt;
&lt;---------------------- 问候 ------------------------&gt;
&lt;------------------ 启动安全轮廓(2) ------------------&gt;
&lt;---------------------- 问候 ------------------------&gt;
&lt;------------------- 启动 IDXP(3) -------------------&gt;
</code></pre>

<p>交互过程:</p>

<ul>
<li>&ldquo;Alice&#8221;建立一个到&#8217;Bob&#8217;的连接, 并触发交换二者BEEP问候消息</li>
<li>两个实体协商BEEP安全轮廓</li>
<li>两个实体协商IDXP轮廓</li>
</ul>


<p><strong>对等体&#8221;Alice&#8221;和&#8221;Bob&#8221;通过代理服务器建立IDXP交换</strong></p>

<p>在一对IDXP对等体之间可以存在多个代理，这些代理可能是因为管理的需要。比如透过防火墙进行受限访问，或是将公司各部门分析器的数据转发到公司总管理器。</p>

<p>在使用代理转发数据时，会使用BEEP协调轮廓建立一个应用层的隧道。隧道轮廓(详细见&#8221;RFC3620 &ndash; The TUNNEL profile&#8221;)即在此时发挥作用。在创建应用层隧道时，必须建立一个作为协调轮廓的隧道，并且该隧道轮廓需要进行SASL认证。隧道建立完成后，BEEP安全轮廓才可以提供IDXP协商时需要的各项安全特性。</p>

<pre><code>Alice              proxy1               proxy2               Bob
  ----- 建立连接 ----&gt;
&lt;------ 问候 -------&gt;
  ---- 启动隧道 -----&gt;
                      --- 建立连接(1) ----&gt;
                    &lt;------- 问候 -------&gt;
                      ----- 启动隧道 -----&gt;
                                           ----- 建立连接 -----&gt;
                                         &lt;------- 问候 -------&gt;
                                           ----- 启动隧道 -----&gt;
                                         &lt;---- &lt;确认&gt;(2) -----
                    &lt;------ &lt;确认&gt; ------
&lt;----- &lt;确认&gt; ------
&lt;--------------------------- 问候 ----------------------------&gt;
&lt;----------------------- 启动安全轮廓 -------------------------&gt;
&lt;--------------------------- 问候 ----------------------------&gt;
&lt;------------------------- 启动 IDXP -------------------------&gt;
</code></pre>

<p>交互过程:</p>

<ul>
<li>收到&#8221;Alice&#8221;启动隧道的消息后，&#8221;proxy1&#8221;并没有立即返回确认消息，而是先试图和&#8221;proxy&#8221;连接以建立隧道。同样的，&#8221;proxy2&#8221;也不会立即给&#8221;proxy1&#8221;返回确认消息</li>
<li>&ldquo;Bob&#8221;的确认信息首先到达&#8221;proxy2&#8221;并且与之启动隧道，然后确认消息会传递下去最终返回给&#8221;Alice&#8221;，最终&#8221;Alice&#8221;和&#8221;Bob&#8221;之间就成功建立了应用层的隧道</li>
</ul>


<h4>1.2 数据传输</h4>

<p>在一对入侵检测实体通过BEEP会话进行通信时，会使用IDXP轮廓打开一个或多个BEEP信道。如果需要，可以用IDXP轮廓建立更多的BEEP会话，以提供额外的信道。但是在多数情况下，还是应该在已有的BEEP会话中添加新的信道，尽量避免用新建BEEP会话的方式添加信道。</p>

<p>在每条信道中，对等体都是以客户端/服务器形式进行通信。客户端和服务器的角色扮演决定于建立BEEP会话的发起者和监听者。即发起者为客户端，监听者为服务器。</p>

<pre><code>+----------+                          +----------+
|          |                          |          |
|          |******** BEEP 会话 *******|          |
|          |                          |          |
|  分析器  | ------- IDXP 轮廓 -----&gt; |  管理器  |
| (客户端) |                          | (服务端) |
|          |                          |          |
|          |**************************|          |
|          |                          |          |
+----------+                          +----------+
</code></pre>

<p>在一个BEEP会话中使用多个BEEP信道的方式对IDXP对等体之间传输数据的分类和优先级的管理非常有利。例如，管理器&#8221;M1&#8221;向&#8221;M2&#8221;发送报警数据时，可以将不同类型的信息使用单独的信道进行传输。&#8221;M1&#8221;在这些信道中扮演了客户端的角色，&#8221;M2&#8221;则对接收到的报警信息根据其不同类型进行相应处理。</p>

<pre><code>+----------+                                            +----------+
|          |                                            |          |
|          |**************** BEEP 会话 *****************|          |
|          |                                            |          |
|          | ----- IDXP 轮廓, 基于网络的报警信息 -----&gt; |          |
|  管理器  |                                            |  管理器  |
|    M1    | ----- IDXP 轮廓, 基于主机的报警信息 -----&gt; |    M2    |
| (客户端) |                                            | (服务端) |
|          | -------- IDXP 轮廓, 其它报警信息 --------&gt; |          |
|          |                                            |          |
|          |********************************************|          |
|          |                                            |          |
+----------+                                            +----------+
</code></pre>

<h4>1.3 断开连接</h4>

<p>在一些情况下(如处理过程中出现错误)，IDXP对等体可以关闭某个IDXP信道。要关闭某条信道，需要在零号信道上发送一条&#8221;关闭&#8221;的指令，并且指明所关闭的信道。如果想要关闭整个BEEP会话，只需在零号信道上发送一条要求&#8221;关闭&#8221;零信道的指令即可。</p>

<p>由于应用层隧道和BEEP安全轮廓会经常使用，所以凡是包含IDXP信道的BEEP会话将会一直存活下去。同时，为了避免IDXP信道被反复的建立，系统会一直保持这些IDXP信道的连接，即使当前已经没有数据在上面传输。建议当IDXP对等体在合适的时候，手动关闭并重建BEEP会话。</p>

<h4>1.4 可信模型</h4>

<p>在以上的模型中，BEEP安全轮廓是建立在IDXP对等体之间从而实现的端到端安全，而无需对中间代理建立信任。因此，只有在安全轮廓下经过协商后的IDXP对等体之间是相互信任的，而代理始终被看作是不可信的。</p>

<h3>2 入侵检测消息交换格式</h3>

<h4>2.1 IDMEF数据模型</h4>

<p>IDMEF数据模型的各主要部分关系如下图所示（这里省略了事件指示器和属性）。
<img class="center" src="/images/articles/201004/intrusion_dedection_and_response_system_for_information_sharing.png" title="数据模型" ></p>

<p>IDMEF消息的最高层类是&#8221;IDMEF-Message&#8221;，其它各类型消息都是该类的子类。目前IDMEF定义了两种消息：&#8221;Alerts&#8221;和&#8221;Heartbeats&#8221;。其中这两个消息各自携带不同的子类，各子类又描述了更加详细的信息。</p>

<p>需要注意的是，数据模型并没有指明警报信息如何分类和识别。例如，端口扫描这一行为，它可能被分析器识别为一次单点对多目标的攻击，同时被另一分析器识别为多次的单点攻击。所有，只有在分析器确定了报警类型之后，数据模型才能确定如何对报警数据进行格式化。</p>

<h4>2.2 示例</h4>

<p>IDMEF数据模型最终是以XML形式实现，XML跨平台、跨语言以及强扩展性的特点保证了IDS设备之间共享信息时良好的兼容性。</p>

<p>下面用实例说明IDMEF对报警信息封装的格式。这些例子只是为说明用，不具备代表性。</p>

<figure class='code'><figcaption><span>基于网络检测到的某次泪滴攻击报警信息</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'>   <span class="nt">&lt;idmef:IDMEF-Message</span> <span class="na">xmlns:idmef=</span><span class="s">&quot;http://iana.org/idmef&quot;</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>     <span class="nt">&lt;idmef:Alert</span> <span class="na">messageid=</span><span class="s">&quot;abc123456789&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>       <span class="nt">&lt;idmef:Analyzer</span> <span class="na">analyzerid=</span><span class="s">&quot;hq-dmz-analyzer01&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>         <span class="nt">&lt;idmef:Node</span> <span class="na">category=</span><span class="s">&quot;dns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>           <span class="nt">&lt;idmef:location&gt;</span>Headquarters DMZ Network<span class="nt">&lt;/idmef:location&gt;</span>
</span><span class='line'>           <span class="nt">&lt;idmef:name&gt;</span>analyzer01.example.com<span class="nt">&lt;/idmef:name&gt;</span>
</span><span class='line'>         <span class="nt">&lt;/idmef:Node&gt;</span>
</span><span class='line'>       <span class="nt">&lt;/idmef:Analyzer&gt;</span>
</span><span class='line'>       <span class="nt">&lt;idmef:CreateTime</span> <span class="na">ntpstamp=</span><span class="s">&quot;0xbc723b45.0xef449129&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>         2000-03-09T10:01:25.93464-05:00
</span><span class='line'>       <span class="nt">&lt;/idmef:CreateTime&gt;</span>
</span><span class='line'>       <span class="nt">&lt;idmef:Source</span> <span class="na">ident=</span><span class="s">&quot;a1b2c3d4&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>         <span class="nt">&lt;idmef:Node</span> <span class="na">ident=</span><span class="s">&quot;a1b2c3d4-001&quot;</span> <span class="na">category=</span><span class="s">&quot;dns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>           <span class="nt">&lt;idmef:name&gt;</span>badguy.example.net<span class="nt">&lt;/idmef:name&gt;</span>
</span><span class='line'>           <span class="nt">&lt;idmef:Address</span> <span class="na">ident=</span><span class="s">&quot;a1b2c3d4-002&quot;</span> <span class="na">category=</span><span class="s">&quot;ipv4-net-mask&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>             <span class="nt">&lt;idmef:address&gt;</span>192.0.2.50<span class="nt">&lt;/idmef:address&gt;</span>
</span><span class='line'>             <span class="nt">&lt;idmef:netmask&gt;</span>255.255.255.255<span class="nt">&lt;/idmef:netmask&gt;</span>
</span><span class='line'>           <span class="nt">&lt;/idmef:Address&gt;</span>
</span><span class='line'>         <span class="nt">&lt;/idmef:Node&gt;</span>
</span><span class='line'>       <span class="nt">&lt;/idmef:Source&gt;</span>
</span><span class='line'>       <span class="nt">&lt;idmef:Target</span> <span class="na">ident=</span><span class="s">&quot;d1c2b3a4&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>         <span class="nt">&lt;idmef:Node</span> <span class="na">ident=</span><span class="s">&quot;d1c2b3a4-001&quot;</span> <span class="na">category=</span><span class="s">&quot;dns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>           <span class="nt">&lt;idmef:Address</span> <span class="na">category=</span><span class="s">&quot;ipv4-addr-hex&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>             <span class="nt">&lt;idmef:address&gt;</span>0xde796f70<span class="nt">&lt;/idmef:address&gt;</span>
</span><span class='line'>           <span class="nt">&lt;/idmef:Address&gt;</span>
</span><span class='line'>         <span class="nt">&lt;/idmef:Node&gt;</span>
</span><span class='line'>       <span class="nt">&lt;/idmef:Target&gt;</span>
</span><span class='line'>       <span class="nt">&lt;idmef:Classification</span> <span class="na">text=</span><span class="s">&quot;Teardrop detected&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>         <span class="nt">&lt;idmef:Reference</span> <span class="na">origin=</span><span class="s">&quot;bugtraqid&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>           <span class="nt">&lt;idmef:name&gt;</span>124<span class="nt">&lt;/idmef:name&gt;</span>
</span><span class='line'>           <span class="nt">&lt;idmef:url&gt;</span>http://www.securityfocus.com/bid/124<span class="nt">&lt;/idmef:url&gt;</span>
</span><span class='line'>         <span class="nt">&lt;/idmef:Reference&gt;</span>
</span><span class='line'>       <span class="nt">&lt;/idmef:Classification&gt;</span>
</span><span class='line'>     <span class="nt">&lt;/idmef:Alert&gt;</span>
</span><span class='line'>   <span class="nt">&lt;/idmef:IDMEF-Message&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>基于网络检测到的某个端口扫描行为（注意<portlist>中记录了被扫描的端口列表）</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'>   <span class="nt">&lt;idmef:IDMEF-Message</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span> <span class="na">xmlns:idmef=</span><span class="s">&quot;http://iana.org/idmef&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>     <span class="nt">&lt;idmef:Alert</span> <span class="na">messageid=</span><span class="s">&quot;abc123456789&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>       <span class="nt">&lt;idmef:Analyzer</span> <span class="na">analyzerid=</span><span class="s">&quot;hq-dmz-analyzer62&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>         <span class="nt">&lt;idmef:Node</span> <span class="na">category=</span><span class="s">&quot;dns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>           <span class="nt">&lt;idmef:location&gt;</span>Headquarters Web Server<span class="nt">&lt;/idmef:location&gt;</span>
</span><span class='line'>           <span class="nt">&lt;idmef:name&gt;</span>analyzer62.example.com<span class="nt">&lt;/idmef:name&gt;</span>
</span><span class='line'>         <span class="nt">&lt;/idmef:Node&gt;</span>
</span><span class='line'>       <span class="nt">&lt;/idmef:Analyzer&gt;</span>
</span><span class='line'>       <span class="nt">&lt;idmef:CreateTime</span> <span class="na">ntpstamp=</span><span class="s">&quot;0xbc72b2b4.0x00000000&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>         2000-03-09T15:31:00-08:00
</span><span class='line'>       <span class="nt">&lt;/idmef:CreateTime&gt;</span>
</span><span class='line'>       <span class="nt">&lt;idmef:Source</span> <span class="na">ident=</span><span class="s">&quot;abc01&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>         <span class="nt">&lt;idmef:Node</span> <span class="na">ident=</span><span class="s">&quot;abc01-01&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>           <span class="nt">&lt;idmef:Address</span> <span class="na">ident=</span><span class="s">&quot;abc01-02&quot;</span> <span class="na">category=</span><span class="s">&quot;ipv4-addr&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>             <span class="nt">&lt;idmef:address&gt;</span>192.0.2.200<span class="nt">&lt;/idmef:address&gt;</span>
</span><span class='line'>           <span class="nt">&lt;/idmef:Address&gt;</span>
</span><span class='line'>         <span class="nt">&lt;/idmef:Node&gt;</span>
</span><span class='line'>       <span class="nt">&lt;/idmef:Source&gt;</span>
</span><span class='line'>       <span class="nt">&lt;idmef:Target</span> <span class="na">ident=</span><span class="s">&quot;def01&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>         <span class="nt">&lt;idmef:Node</span> <span class="na">ident=</span><span class="s">&quot;def01-01&quot;</span> <span class="na">category=</span><span class="s">&quot;dns&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>           <span class="nt">&lt;idmef:name&gt;</span>www.example.com<span class="nt">&lt;/idmef:name&gt;</span>
</span><span class='line'>           <span class="nt">&lt;idmef:Address</span> <span class="na">ident=</span><span class="s">&quot;def01-02&quot;</span> <span class="na">category=</span><span class="s">&quot;ipv4-addr&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>             <span class="nt">&lt;idmef:address&gt;</span>192.0.2.50<span class="nt">&lt;/idmef:address&gt;</span>
</span><span class='line'>           <span class="nt">&lt;/idmef:Address&gt;</span>
</span><span class='line'>         <span class="nt">&lt;/idmef:Node&gt;</span>
</span><span class='line'>         <span class="nt">&lt;idmef:Service</span> <span class="na">ident=</span><span class="s">&quot;def01-03&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>           <span class="nt">&lt;idmef:portlist&gt;</span>5-25,37,42,43,53,69-119,123-514
</span><span class='line'>           <span class="nt">&lt;/idmef:portlist&gt;</span>
</span><span class='line'>         <span class="nt">&lt;/idmef:Service&gt;</span>
</span><span class='line'>       <span class="nt">&lt;/idmef:Target&gt;</span>
</span><span class='line'>       <span class="nt">&lt;idmef:Classification</span> <span class="na">text=</span><span class="s">&quot;simple portscan&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>         <span class="nt">&lt;idmef:Reference</span> <span class="na">origin=</span><span class="s">&quot;vendor-specific&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>           <span class="nt">&lt;idmef:name&gt;</span>portscan<span class="nt">&lt;/idmef:name&gt;</span>
</span><span class='line'>           <span class="nt">&lt;idmef:url&gt;</span>http://www.vendor.com/portscan<span class="nt">&lt;/idmef:url&gt;</span>
</span><span class='line'>         <span class="nt">&lt;/idmef:Reference&gt;</span>
</span><span class='line'>       <span class="nt">&lt;/idmef:Classification&gt;</span>
</span><span class='line'>     <span class="nt">&lt;/idmef:Alert&gt;</span>
</span><span class='line'>   <span class="nt">&lt;/idmef:IDMEF-Message&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>3 参考资料</h3>

<pre><code>1. RFC4765 - The Intrusion Detection Message Exchange Format (IDMEF)
2. RFC4767 - The Intrusion Detection Exchange Protocol (IDXP)
</code></pre>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2010-04-13T19:35:00+08:00" data-updated="true" itemprop="datePublished">Apr 13<span>th</span>, 2010</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/programming/'>Programming</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2010/04/13/reverse-order-of-words-in-a-string/" itemprop="url">字符串中单词逆序的实现</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>在Java中可以用压栈/弹栈的方式：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">import</span><span class="err"> </span><span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Stack</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span><span class="err"> </span><span class="n">class</span><span class="err"> </span><span class="n">StackTest</span><span class="err"> </span><span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span><span class="err"> </span><span class="kd">static</span><span class="err"> </span><span class="kt">void</span><span class="err"> </span><span class="n">main</span><span class="o">(</span><span class="n">String</span><span class="err"> </span><span class="n">argv</span><span class="o">[])</span><span class="err"> </span><span class="o">{</span>
</span><span class='line'>        <span class="n">Stack</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="err"> </span><span class="n">stack</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="k">new</span><span class="err"> </span><span class="n">Stack</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
</span><span class='line'>        <span class="k">for</span><span class="o">(</span><span class="n">String</span><span class="err"> </span><span class="n">s</span><span class="err"> </span><span class="o">:</span><span class="err"> </span><span class="s">&quot;I have a round peach&quot;</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot; &quot;</span><span class="o">))</span><span class="err"> </span><span class="o">{</span>
</span><span class='line'>            <span class="c1">// 按字符串原顺序压栈</span>
</span><span class='line'>            <span class="n">stack</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">while</span><span class="o">(!</span><span class="n">stack</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span><span class="err"> </span><span class="o">{</span>
</span><span class='line'>            <span class="c1">// 弹栈并输出</span>
</span><span class='line'><span class="err">   </span>         <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">stack</span><span class="o">.</span><span class="na">pop</span><span class="o">()</span><span class="err"> </span><span class="o">+</span><span class="err"> </span><span class="s">&quot; &quot;</span><span class="o">);</span>
</span><span class='line'><span class="err">  </span>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>运行后系统将输出 &ldquo;peach round a have I &#8220;。</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2010-01-30T00:29:00+08:00" data-updated="true" itemprop="datePublished">Jan 30<span>th</span>, 2010</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2010/01/30/analysis-of-the-forward-slash-and-backslash/" itemprop="url">正斜杠与反斜杠的分析</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>　　正斜杠(左斜杠)，符号是&#8221;/&ldquo;；反斜杠(右斜杠)，符号是&rdquo;\&ldquo;。</p>

<p>　　在Unix/Linux中，路径的分隔采用正斜杠&#8221;/&ldquo;，比如&rdquo;/home/hutaow&#8221;；而在Windows中，路径分隔采用反斜杠&#8221;\&ldquo;，比如&#8221;C:\Windows\System&#8221;。</p>

<p>　　有时我们会看到这样的路径写法，&#8221;C:&#92;\Windows&#92;\System&#8221;，也就是用两个反斜杠来分隔路径，这种写法在网络应用或编程中经常看到，事实上，上面这个路径可以用&#8221;C:/Windows/System&#8221;来代替，不会出错。但是如果写成了&#8221;C:\Windows\System&#8221;，那就可能会出现各种奇怪的错误了。</p>

<p>　　至于上述问题出现的原因，要从字符串解析这方面来分析。</p>

<p>　　学过编程的人都应该知道，在C里面，输出字符串时，如果想输出一个换行，那就要加上&#8217;\n&#8217;这个标志，类似的，输出一个TAB，就加上&#8217;\t&#8217;，也就是说，反斜杠(&ldquo;\&rdquo;)这个符号会把跟在它后面的字符结合起来转义成其它字符。根据这个原理，如果想输出双引号(&lsquo;&ldquo;&rsquo;)，就需要输入&#8217;\&rdquo;&lsquo;，这样才会将包含了双引号的字符串正确的写入内存中。那么如果想输入一个反斜杠呢？很简单，只要敲&rsquo;&#92;\&lsquo;就可以了。</p>

<p>　　看到这里或许有些人已经看出眉目了，如果&#8221;C:\Windows\System&#8221;这个路径字符串交给C编译器编译，实际写入内存的字符串并没有包含反斜杠&#8221;\&ldquo;，甚至紧跟在反斜杠后面的字母也一起被转义成了其它的字符，再次调用的话势必会出问题。</p>

<p>　　字符串解析不仅仅局限于C编译器，Java编译器、一些配置文件的解析、Web服务器等等，都会遇到对字符串进行解析的这个问题，由于传统的Windows采用的是单个斜杠的路径分隔形式，导致在对文件路径进行解析的时候可能发生不必要的错误，所以就出现了用双反斜杠&#8221;&#92;\&ldquo;分隔路径的形式。不管解析引擎是否将反斜杠解析成转义字符，最终在内存中得到的都是&rdquo;\&ldquo;，结果也就不会出问题了。</p>

<p>　　由此也可以看出Windows或者说DOS在设计初期考虑不够周全，为了和Unix一些特征区别开来，将Unix中的正斜杠&#8221;/&ldquo;分隔路径方式改变成了反斜杠&rdquo;\&ldquo;。这样改变导致的一个问题就是在早期DOS命令行中，正常的文件名是不能包含空格的，如果包含了空格，会导致输入这样的文件名时，命令解析无法将其和参数区分开。例如，想要进入&#8221;hutaow yuan&#8221;这个目录（在此先忽略8.3命名规则），直接输入&#8221;cd hutaow yuan&#8221;，命令行会将其解析为进入&#8221;hutaow&#8221;目录，而后面的&#8221;yuan&#8221;做参数，这显然不是所期望的。</p>

<p>　　而在Unix中，文件名如果包含空格，可以直接在空格前加上反斜杠&#8221;\&ldquo;进行转义，从而很好的和命令参数区别出来（参数之间一般使用空格分隔）。还是上面的例子，在Unix中，只要输入&#8221;cd hutaow\ yuan&rdquo;(在yuan前面的空格前加上&#8221;\&ldquo;)，命令行会正确的辨认出&#8221;hutaow yuan&#8221;并进入这个目录。</p>

<p>　　当然，现在Windows的后续版本已经使用其它方法（比如文件名用双引号括住）解决了空格问题。</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2010-01-14T20:28:00+08:00" data-updated="true" itemprop="datePublished">Jan 14<span>th</span>, 2010</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2010/01/14/interesting-features-in-htc-diamond/" itemprop="url">HTC Diamond 两个有意思的功能</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>这两天一直折腾 HTC Diamond，发现了两个很有意思的功能：</p>

<ol>
<li><p>Diamond的手写笔不像其它手机那样有卡槽卡住，而是像有磁铁一样把笔&#8221;吸&#8221;进去，实际上功能远不止这个。在Diamond关闭屏幕时，拔出手写笔，屏幕会自动亮起，还有比这更神奇的，在打电话时，如果拔出手写笔，Diamond会打开便签，并且便签已经包含了通话对象、时间等信息，方便记录；</p></li>
<li><p>Diamond的重力感应不仅用在玩游戏上，来电话时，只要把手机面向下放，就可以关闭铃声（静音）。这避免了在开会等类似场合突然遇到来电手忙脚乱情况的发生。</p></li>
</ol>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2010-01-12T22:53:00+08:00" data-updated="true" itemprop="datePublished">Jan 12<span>th</span>, 2010</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/technology/'>Technology</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2010/01/12/slove-the-problem-that-xmarks-was-block-by-gfw/" itemprop="url">Xmarks(原Foxmarks)被墙之后更新的方法</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>最近重新装上Xmarks书签同步之后，发现不能用了，还以为设置出了问题，上官网发现已经上不去了，被GFW屏蔽了。于是上网查找解决办法，总结如下：</p>

<h4>1. 手动添加域名解析的地址，即向“C:\Windows\System32\Drivers\etc\hosts&#8221;文件中添加如下内容：</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Xmarks
</span><span class='line'>64.147.188.86 www.xmarks.com
</span><span class='line'>64.147.188.92 api.xmarks.com
</span><span class='line'>64.147.188.89 login.xmarks.com
</span><span class='line'>64.147.188.87 sync.xmarks.com
</span><span class='line'>64.147.188.86 static.xmarks.com
</span><span class='line'>64.147.188.86 download.xmarks.com
</span><span class='line'>64.147.188.86 my.xmarks.com</span></code></pre></td></tr></table></div></figure>


<h4>2. 设置Xmarks连接及传输数据过程中加密，即在&#8221;Connection Security&#8221;中选择&#8221;Encrypt All&#8221;。</h4>

<p>以上两步即可解决Xmarks不能同步的问题。</p>

<h4>分析原因：</h4>

<ol>
<li><p>第一步操作的原因在于GFW是根据URL而不是IP进行过滤的，所以在请求解析诸如&#8221;xmarks.com&#8221;等类似的域名时，返回结果被GFW拦截，所以要手动添加xmarks.com一系列服务器的域名IP；</p></li>
<li><p>第二步操作让Xmarks在同步时对数据进行加密，GFW是无法认出加密的数据的，也就无法进一步拦截了。</p></li>
</ol>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2009-05-02T14:02:00+08:00" data-updated="true" itemprop="datePublished">May 2<span>nd</span>, 2009</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/programming/'>Programming</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2009/05/02/mark-atl-control-as-a-safe-control/" itemprop="url">标记ATL控件为安全控件</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>用ATL开发网页控件时，IE总会出现“该控件不是安全的”之类的提示，去掉这个提示的方法就是使用 IObjectSafety 将其标记为可安全初始化的控件。</p>

<p>实现方法如下：</p>

<p>首先在需要将 IObjectSafetyImpl 添加到该控件的派生类中，然后在映射列表中添加 IObjectSafety，具体添加的代码如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="k">class</span> <span class="nc">CHutaow</span> <span class="o">:</span><span class="err"> </span>
</span><span class='line'>    <span class="c1">// 添加到控件的派生类列表中</span>
</span><span class='line'>    <span class="k">public</span> <span class="n">IObjectSafetyImpl</span><span class="o">&lt;</span><span class="n">CHutaow</span><span class="p">,</span> <span class="n">INTERFACESAFE_FOR_UNTRUSTED_CALLER</span><span class="o">|</span><span class="n">INTERFACESAFE_FOR_UNTRUSTED_DATA</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span><span class="o">:</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">BEGIN_COM_MAP</span><span class="p">(</span><span class="n">CHutaow</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">COM_INTERFACE_ENTRY</span><span class="p">(</span><span class="n">IObjectSafety</span><span class="p">)</span><span class="err"> </span><span class="c1">//创建IObjectSafety的映射</span>
</span><span class='line'>
</span><span class='line'>        <span class="p">...</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">END_COM_MAP</span><span class="p">()</span>
</span><span class='line'>        <span class="p">...</span>
</span><span class='line'>    <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>PS: 如果出现&#8221;&lsquo;IObjectSafetyImpl&rsquo; : base class undefined&#8221;的错误，则需要添加&#8221;atlctl.h&#8221;头文件。</p>

		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2010 - Wang Tao -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			

<script type="text/javascript">
      var disqus_shortname = 'hutaow';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>







		</div>
	</div>
</body>
</html>
